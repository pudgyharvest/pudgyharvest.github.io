const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Btaf4GYW.js","assets/index-DeWtL4hk.js","assets/index-_SSteYJ0.css"])))=>i.map(i=>d[i]);
import{p as Tc,r as X,o as $c,t as u0,w as Vl,u as Fl,v as Nc,x as Ea,y as h0,q as oa,z as wi,V as l0,M as f0,N as B,A as p0,C as mc,D as d0,K as g0,E as y0,F as Kh,G as v0,J as m0,L as w0,O as Vh,$ as _0,P as b0,Q as E0,R as Gs,S as Fh,X as I0,T as x0,U as Bl,W as qr,Y as P0,Z as Bh,a0 as fs,a1 as St,a2 as kt,a3 as mi,a4 as ar,a5 as S0,a6 as ps,a7 as Gl,a8 as O0,a9 as R0,aa as A0,ab as Wl,ac as C0,ad as Jl,ae as Ql,af as gs,ag as wc,ah as ga,ai as ys,aj as T0,ak as ya,al as $0,am as N0,an as D0,ao as q0,ap as ca,aq as L0,ar as j0,as as rc,at as Gh,au as z0,av as M0,aw as U0,ax as Wh,ay as H0,az as k0,aA as K0,aB as V0,aC as F0,aD as B0,aE as G0,aF as Vs,aG as Yl,aH as ic,aI as W0,aJ as J0,_ as Q0}from"./index-DeWtL4hk.js";import{s as Ys,a as Ia,e as Sr,r as Zl,f as Ui,g as Dc,i as Lr,b as Zs,c as Jh,d as Y0,h as Z0,j as qc,p as X0,k as Lc,l as xa,E as jc,m as vi,n as ew,o as Ei}from"./index.es-C92pon74.js";const tw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,rw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,iw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function sw(o,t){if(o==="__proto__"||o==="constructor"&&t&&typeof t=="object"&&"prototype"in t){nw(o);return}return t}function nw(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function ua(o,t={}){if(typeof o!="string")return o;const r=o.trim();if(o[0]==='"'&&o.endsWith('"')&&!o.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!iw.test(o)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(tw.test(o)||rw.test(o)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,sw)}return JSON.parse(o)}catch(s){if(t.strict)throw s;return o}}function aw(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function qt(o,...t){try{return aw(o(...t))}catch(r){return Promise.reject(r)}}function ow(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function cw(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function va(o){if(ow(o))return String(o);if(cw(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return va(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Xl(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const _c="base64:";function uw(o){if(typeof o=="string")return o;Xl();const t=Buffer.from(o).toString("base64");return _c+t}function hw(o){return typeof o!="string"||!o.startsWith(_c)?o:(Xl(),Buffer.from(o.slice(_c.length),"base64"))}function nr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function lw(...o){return nr(o.join(":"))}function ha(o){return o=nr(o),o?o+":":""}const fw="memory",pw=()=>{const o=new Map;return{name:fw,options:{},hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,r){o.set(t,r)},setItemRaw(t,r){o.set(t,r)},removeItem(t){o.delete(t)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function dw(o={}){const t={mounts:{"":o.driver||pw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const _ of t.mountpoints)if(g.startsWith(_))return{base:_,relativeKey:g.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:g,driver:t.mounts[""]}},s=(g,_)=>t.mountpoints.filter(S=>S.startsWith(g)||_&&g.startsWith(S)).map(S=>({relativeBase:g.length>S.length?g.slice(S.length):void 0,mountpoint:S,driver:t.mounts[S]})),a=(g,_)=>{if(t.watching){_=nr(_);for(const S of t.watchListeners)S(g,_)}},u=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await Qh(t.mounts[g],a,g)}},f=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},y=(g,_,S)=>{const R=new Map,D=C=>{let Z=R.get(C.base);return Z||(Z={driver:C.driver,base:C.base,items:[]},R.set(C.base,Z)),Z};for(const C of g){const Z=typeof C=="string",se=nr(Z?C:C.key),ne=Z?void 0:C.value,ce=Z||!C.options?_:{..._,...C.options},ae=r(se);D(ae).items.push({key:se,value:ne,relativeKey:ae.relativeKey,options:ce})}return Promise.all([...R.values()].map(C=>S(C))).then(C=>C.flat())},m={hasItem(g,_={}){g=nr(g);const{relativeKey:S,driver:R}=r(g);return qt(R.hasItem,S,_)},getItem(g,_={}){g=nr(g);const{relativeKey:S,driver:R}=r(g);return qt(R.getItem,S,_).then(D=>ua(D))},getItems(g,_){return y(g,_,S=>S.driver.getItems?qt(S.driver.getItems,S.items.map(R=>({key:R.relativeKey,options:R.options})),_).then(R=>R.map(D=>({key:lw(S.base,D.key),value:ua(D.value)}))):Promise.all(S.items.map(R=>qt(S.driver.getItem,R.relativeKey,R.options).then(D=>({key:R.key,value:ua(D)})))))},getItemRaw(g,_={}){g=nr(g);const{relativeKey:S,driver:R}=r(g);return R.getItemRaw?qt(R.getItemRaw,S,_):qt(R.getItem,S,_).then(D=>hw(D))},async setItem(g,_,S={}){if(_===void 0)return m.removeItem(g);g=nr(g);const{relativeKey:R,driver:D}=r(g);D.setItem&&(await qt(D.setItem,R,va(_),S),D.watch||a("update",g))},async setItems(g,_){await y(g,_,async S=>{if(S.driver.setItems)return qt(S.driver.setItems,S.items.map(R=>({key:R.relativeKey,value:va(R.value),options:R.options})),_);S.driver.setItem&&await Promise.all(S.items.map(R=>qt(S.driver.setItem,R.relativeKey,va(R.value),R.options)))})},async setItemRaw(g,_,S={}){if(_===void 0)return m.removeItem(g,S);g=nr(g);const{relativeKey:R,driver:D}=r(g);if(D.setItemRaw)await qt(D.setItemRaw,R,_,S);else if(D.setItem)await qt(D.setItem,R,uw(_),S);else return;D.watch||a("update",g)},async removeItem(g,_={}){typeof _=="boolean"&&(_={removeMeta:_}),g=nr(g);const{relativeKey:S,driver:R}=r(g);R.removeItem&&(await qt(R.removeItem,S,_),(_.removeMeta||_.removeMata)&&await qt(R.removeItem,S+"$",_),R.watch||a("remove",g))},async getMeta(g,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),g=nr(g);const{relativeKey:S,driver:R}=r(g),D=Object.create(null);if(R.getMeta&&Object.assign(D,await qt(R.getMeta,S,_)),!_.nativeOnly){const C=await qt(R.getItem,S+"$",_).then(Z=>ua(Z));C&&typeof C=="object"&&(typeof C.atime=="string"&&(C.atime=new Date(C.atime)),typeof C.mtime=="string"&&(C.mtime=new Date(C.mtime)),Object.assign(D,C))}return D},setMeta(g,_,S={}){return this.setItem(g+"$",_,S)},removeMeta(g,_={}){return this.removeItem(g+"$",_)},async getKeys(g,_={}){g=ha(g);const S=s(g,!0);let R=[];const D=[];for(const C of S){const se=(await qt(C.driver.getKeys,C.relativeBase,_)).map(ne=>C.mountpoint+nr(ne)).filter(ne=>!R.some(ce=>ne.startsWith(ce)));D.push(...se),R=[C.mountpoint,...R.filter(ne=>!ne.startsWith(C.mountpoint))]}return g?D.filter(C=>C.startsWith(g)&&!C.endsWith("$")):D.filter(C=>!C.endsWith("$"))},async clear(g,_={}){g=ha(g),await Promise.all(s(g,!1).map(async S=>{if(S.driver.clear)return qt(S.driver.clear,S.relativeBase,_);if(S.driver.removeItem){const R=await S.driver.getKeys(S.relativeBase||"",_);return Promise.all(R.map(D=>S.driver.removeItem(D,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>Yh(g)))},async watch(g){return await u(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==g),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(g,_){if(g=ha(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((S,R)=>R.length-S.length)),t.mounts[g]=_,t.watching&&Promise.resolve(Qh(_,a,g)).then(S=>{t.unwatch[g]=S}).catch(console.error),m},async unmount(g,_=!0){g=ha(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&(t.unwatch[g](),delete t.unwatch[g]),_&&await Yh(t.mounts[g]),t.mountpoints=t.mountpoints.filter(S=>S!==g),delete t.mounts[g])},getMount(g=""){g=nr(g)+":";const _=r(g);return{driver:_.driver,base:_.base}},getMounts(g="",_={}){return g=nr(g),s(g,_.parents).map(R=>({driver:R.driver,base:R.mountpoint}))}};return m}function Qh(o,t,r){return o.watch?o.watch((s,a)=>t(s,r+a)):()=>{}}async function Yh(o){typeof o.dispose=="function"&&await qt(o.dispose)}function Hi(o){return new Promise((t,r)=>{o.oncomplete=o.onsuccess=()=>t(o.result),o.onabort=o.onerror=()=>r(o.error)})}function ef(o,t){const r=indexedDB.open(o);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Hi(r);return(a,u)=>s.then(f=>u(f.transaction(t,a).objectStore(t)))}let sc;function Xs(){return sc||(sc=ef("keyval-store","keyval")),sc}function Zh(o,t=Xs()){return t("readonly",r=>Hi(r.get(o)))}function gw(o,t,r=Xs()){return r("readwrite",s=>(s.put(t,o),Hi(s.transaction)))}function yw(o,t=Xs()){return t("readwrite",r=>(r.delete(o),Hi(r.transaction)))}function vw(o=Xs()){return o("readwrite",t=>(t.clear(),Hi(t.transaction)))}function mw(o,t){return o.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Hi(o.transaction)}function ww(o=Xs()){return o("readonly",t=>{if(t.getAllKeys)return Hi(t.getAllKeys());const r=[];return mw(t,s=>r.push(s.key)).then(()=>r)})}const _w="idb-keyval";var bw=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>t+a;let s;return o.dbName&&o.storeName&&(s=ef(o.dbName,o.storeName)),{name:_w,options:o,async hasItem(a){return!(typeof await Zh(r(a),s)>"u")},async getItem(a){return await Zh(r(a),s)??null},setItem(a,u){return gw(r(a),u,s)},removeItem(a){return yw(r(a),s)},getKeys(){return ww(s)},clear(){return vw(s)}}};const Ew="WALLET_CONNECT_V2_INDEXED_DB",Iw="keyvaluestorage";let xw=class{constructor(){this.indexedDb=dw({driver:bw({dbName:Ew,storeName:Iw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Ys(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var nc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ma={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof nc<"u"&&nc.localStorage?ma.exports=nc.localStorage:typeof window<"u"&&window.localStorage?ma.exports=window.localStorage:ma.exports=new t})();function Pw(o){var t;return[o[0],Ia((t=o[1])!=null?t:"")]}class Sw{constructor(){this.localStorage=ma.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Pw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return Ia(r)}async setItem(t,r){this.localStorage.setItem(t,Ys(r))}async removeItem(t){this.localStorage.removeItem(t)}}const Ow="wc_storage_version",Xh=1,Rw=async(o,t,r)=>{const s=Ow,a=await t.getItem(s);if(a&&a>=Xh){r(t);return}const u=await o.getKeys();if(!u.length){r(t);return}const f=[];for(;u.length;){const y=u.shift();if(!y)continue;const m=y.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const g=await o.getItem(y);await t.setItem(y,g),f.push(y)}}await t.setItem(s,Xh),r(t),Aw(o,f)},Aw=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let Cw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Sw;this.storage=t;try{const r=new xw;Rw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var vs={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bc=function(o,t){return bc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},bc(o,t)};function Tw(o,t){bc(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Ec=function(){return Ec=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},Ec.apply(this,arguments)};function $w(o,t){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function Nw(o,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,r,s);else for(var y=o.length-1;y>=0;y--)(f=o[y])&&(u=(a<3?f(u):a>3?f(t,r,u):f(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function Dw(o,t){return function(r,s){t(r,s,o)}}function qw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function Lw(o,t,r,s){function a(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function y(_){try{g(s.next(_))}catch(S){f(S)}}function m(_){try{g(s.throw(_))}catch(S){f(S)}}function g(_){_.done?u(_.value):a(_.value).then(y,m)}g((s=s.apply(o,t||[])).next())})}function jw(o,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,f;return f={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function y(g){return function(_){return m([g,_])}}function m(g){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=g[0]&2?a.return:g[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,g[1])).done)return u;switch(a=0,u&&(g=[g[0]&2,u.value]),g[0]){case 0:case 1:u=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,a=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!u||g[1]>u[0]&&g[1]<u[3])){r.label=g[1];break}if(g[0]===6&&r.label<u[1]){r.label=u[1],u=g;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(g);break}u[2]&&r.ops.pop(),r.trys.pop();continue}g=t.call(o,r)}catch(_){g=[6,_],a=0}finally{s=u=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function zw(o,t,r,s){s===void 0&&(s=r),o[s]=t[r]}function Mw(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Ic(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tf(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(y){f={error:y}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return u}function Uw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(tf(arguments[t]));return o}function Hw(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<r;t++)for(var u=arguments[t],f=0,y=u.length;f<y;f++,a++)s[a]=u[f];return s}function Ws(o){return this instanceof Ws?(this.v=o,this):new Ws(o)}function kw(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,t||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){s[R]&&(a[R]=function(D){return new Promise(function(C,Z){u.push([R,D,C,Z])>1||y(R,D)})})}function y(R,D){try{m(s[R](D))}catch(C){S(u[0][3],C)}}function m(R){R.value instanceof Ws?Promise.resolve(R.value.v).then(g,_):S(u[0][2],R)}function g(R){y("next",R)}function _(R){y("throw",R)}function S(R,D){R(D),u.shift(),u.length&&y(u[0][0],u[0][1])}}function Kw(o){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(f){return(r=!r)?{value:Ws(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function Vw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Ic=="function"?Ic(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(f){return new Promise(function(y,m){f=o[u](f),a(y,m,f.done,f.value)})}}function a(u,f,y,m){Promise.resolve(m).then(function(g){u({value:g,done:y})},f)}}function Fw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Bw(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function Gw(o){return o&&o.__esModule?o:{default:o}}function Ww(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function Jw(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const Qw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ec},__asyncDelegator:Kw,__asyncGenerator:kw,__asyncValues:Vw,__await:Ws,__awaiter:Lw,__classPrivateFieldGet:Ww,__classPrivateFieldSet:Jw,__createBinding:zw,__decorate:Nw,__exportStar:Mw,__extends:Tw,__generator:jw,__importDefault:Gw,__importStar:Bw,__makeTemplateObject:Fw,__metadata:qw,__param:Dw,__read:tf,__rest:$w,__spread:Uw,__spreadArrays:Hw,__values:Ic},Symbol.toStringTag,{value:"Module"})),Pa=Tc(Qw);var js={},ac={},zs={};class ki{}const Yw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ki},Symbol.toStringTag,{value:"Module"})),Zw=Tc(Yw);var el;function Xw(){if(el)return zs;el=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.IHeartBeat=void 0;const o=Zw;class t extends o.IEvents{constructor(s){super()}}return zs.IHeartBeat=t,zs}var tl;function rf(){return tl||(tl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Pa.__exportStar(Xw(),o)}(ac)),ac}var oc={},Mi={},rl;function e_(){if(rl)return Mi;rl=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.HEARTBEAT_EVENTS=Mi.HEARTBEAT_INTERVAL=void 0;const o=X;return Mi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Mi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Mi}var il;function sf(){return il||(il=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Pa.__exportStar(e_(),o)}(oc)),oc}var sl;function t_(){if(sl)return js;sl=1,Object.defineProperty(js,"__esModule",{value:!0}),js.HeartBeat=void 0;const o=Pa,t=Sr,r=X,s=rf(),a=sf();class u extends s.IHeartBeat{constructor(y){super(y),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return o.__awaiter(this,void 0,void 0,function*(){const m=new u(y);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,m){this.events.on(y,m)}once(y,m){this.events.once(y,m)}off(y,m){this.events.off(y,m)}removeListener(y,m){this.events.removeListener(y,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return js.HeartBeat=u,js}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Pa;t.__exportStar(t_(),o),t.__exportStar(rf(),o),t.__exportStar(sf(),o)})(vs);function r_(o){try{return JSON.stringify(o)}catch{return'"[Circular]"'}}var i_=s_;function s_(o,t,r){var s=r&&r.stringify||r_,a=1;if(typeof o=="object"&&o!==null){var u=t.length+a;if(u===1)return o;var f=new Array(u);f[0]=s(o);for(var y=1;y<u;y++)f[y]=s(t[y]);return f.join(" ")}if(typeof o!="string")return o;var m=t.length;if(m===0)return o;for(var g="",_=1-a,S=-1,R=o&&o.length||0,D=0;D<R;){if(o.charCodeAt(D)===37&&D+1<R){switch(S=S>-1?S:0,o.charCodeAt(D+1)){case 100:case 102:if(_>=m||t[_]==null)break;S<D&&(g+=o.slice(S,D)),g+=Number(t[_]),S=D+2,D++;break;case 105:if(_>=m||t[_]==null)break;S<D&&(g+=o.slice(S,D)),g+=Math.floor(Number(t[_])),S=D+2,D++;break;case 79:case 111:case 106:if(_>=m||t[_]===void 0)break;S<D&&(g+=o.slice(S,D));var C=typeof t[_];if(C==="string"){g+="'"+t[_]+"'",S=D+2,D++;break}if(C==="function"){g+=t[_].name||"<anonymous>",S=D+2,D++;break}g+=s(t[_]),S=D+2,D++;break;case 115:if(_>=m)break;S<D&&(g+=o.slice(S,D)),g+=String(t[_]),S=D+2,D++;break;case 37:S<D&&(g+=o.slice(S,D)),g+="%",S=D+2,D++,_--;break}++_}++D}return S===-1?o:(S<R&&(g+=o.slice(S)),g)}const nl=i_;var n_=Vr;const Js=g_().console||{},a_={mapHttpRequest:la,mapHttpResponse:la,wrapRequestSerializer:cc,wrapResponseSerializer:cc,wrapErrorSerializer:cc,req:la,res:la,err:l_};function o_(o,t){return Array.isArray(o)?o.filter(function(s){return s!=="!stdSerializers.err"}):o===!0?Object.keys(t):!1}function Vr(o){o=o||{},o.browser=o.browser||{};const t=o.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=o.browser.write||Js;o.browser.write&&(o.browser.asObject=!0);const s=o.serializers||{},a=o_(o.browser.serialize,s);let u=o.browser.serialize;Array.isArray(o.browser.serialize)&&o.browser.serialize.indexOf("!stdSerializers.err")>-1&&(u=!1);const f=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),o.enabled===!1&&(o.level="silent");const y=o.level||"info",m=Object.create(r);m.log||(m.log=Qs),Object.defineProperty(m,"levelVal",{get:_}),Object.defineProperty(m,"level",{get:S,set:R});const g={transmit:t,serialize:a,asObject:o.browser.asObject,levels:f,timestamp:f_(o)};m.levels=Vr.levels,m.level=y,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=Qs,m.serializers=s,m._serialize=a,m._stdErrSerialize=u,m.child=D,t&&(m._logEvent=xc());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function S(){return this._level}function R(C){if(C!=="silent"&&!this.levels.values[C])throw Error("unknown level "+C);this._level=C,hs(g,m,"error","log"),hs(g,m,"fatal","error"),hs(g,m,"warn","error"),hs(g,m,"info","log"),hs(g,m,"debug","log"),hs(g,m,"trace","log")}function D(C,Z){if(!C)throw new Error("missing bindings for child Pino");Z=Z||{},a&&C.serializers&&(Z.serializers=C.serializers);const se=Z.serializers;if(a&&se){var ne=Object.assign({},s,se),ce=o.browser.serialize===!0?Object.keys(ne):a;delete C.serializers,Sa([C],ce,ne,this._stdErrSerialize)}function ae(te){this._childLevel=(te._childLevel|0)+1,this.error=ls(te,C,"error"),this.fatal=ls(te,C,"fatal"),this.warn=ls(te,C,"warn"),this.info=ls(te,C,"info"),this.debug=ls(te,C,"debug"),this.trace=ls(te,C,"trace"),ne&&(this.serializers=ne,this._serialize=ce),t&&(this._logEvent=xc([].concat(te._logEvent.bindings,C)))}return ae.prototype=this,new ae(this)}return m}Vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Vr.stdSerializers=a_;Vr.stdTimeFunctions=Object.assign({},{nullTime:nf,epochTime:af,unixTime:p_,isoTime:d_});function hs(o,t,r,s){const a=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?Qs:a[r]?a[r]:Js[r]||Js[s]||Qs,c_(o,t,r)}function c_(o,t,r){!o.transmit&&t[r]===Qs||(t[r]=function(s){return function(){const u=o.timestamp(),f=new Array(arguments.length),y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Js?Js:this;for(var m=0;m<f.length;m++)f[m]=arguments[m];if(o.serialize&&!o.asObject&&Sa(f,this._serialize,this.serializers,this._stdErrSerialize),o.asObject?s.call(y,u_(this,r,f,u)):s.apply(y,f),o.transmit){const g=o.transmit.level||t.level,_=Vr.levels.values[g],S=Vr.levels.values[r];if(S<_)return;h_(this,{ts:u,methodLevel:r,methodValue:S,transmitLevel:g,transmitValue:Vr.levels.values[o.transmit.level||t.level],send:o.transmit.send,val:t.levelVal},f)}}}(t[r]))}function u_(o,t,r,s){o._serialize&&Sa(r,o._serialize,o.serializers,o._stdErrSerialize);const a=r.slice();let u=a[0];const f={};s&&(f.time=s),f.level=Vr.levels.values[t];let y=(o._childLevel|0)+1;if(y<1&&(y=1),u!==null&&typeof u=="object"){for(;y--&&typeof a[0]=="object";)Object.assign(f,a.shift());u=a.length?nl(a.shift(),a):void 0}else typeof u=="string"&&(u=nl(a.shift(),a));return u!==void 0&&(f.msg=u),f}function Sa(o,t,r,s){for(const a in o)if(s&&o[a]instanceof Error)o[a]=Vr.stdSerializers.err(o[a]);else if(typeof o[a]=="object"&&!Array.isArray(o[a]))for(const u in o[a])t&&t.indexOf(u)>-1&&u in r&&(o[a][u]=r[u](o[a][u]))}function ls(o,t,r){return function(){const s=new Array(1+arguments.length);s[0]=t;for(var a=1;a<s.length;a++)s[a]=arguments[a-1];return o[r].apply(this,s)}}function h_(o,t,r){const s=t.send,a=t.ts,u=t.methodLevel,f=t.methodValue,y=t.val,m=o._logEvent.bindings;Sa(r,o._serialize||Object.keys(o.serializers),o.serializers,o._stdErrSerialize===void 0?!0:o._stdErrSerialize),o._logEvent.ts=a,o._logEvent.messages=r.filter(function(g){return m.indexOf(g)===-1}),o._logEvent.level.label=u,o._logEvent.level.value=f,s(u,o._logEvent,y),o._logEvent=xc(m)}function xc(o){return{ts:0,messages:[],bindings:o||[],level:{label:"",value:0}}}function l_(o){const t={type:o.constructor.name,msg:o.message,stack:o.stack};for(const r in o)t[r]===void 0&&(t[r]=o[r]);return t}function f_(o){return typeof o.timestamp=="function"?o.timestamp:o.timestamp===!1?nf:af}function la(){return{}}function cc(o){return o}function Qs(){}function nf(){return!1}function af(){return Date.now()}function p_(){return Math.round(Date.now()/1e3)}function d_(){return new Date(Date.now()).toISOString()}function g_(){function o(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return o(self)||o(window)||o(this)||{}}}const Oa=$c(n_),y_={level:"info"},en="custom_context";var v_=Object.defineProperty,m_=Object.defineProperties,w_=Object.getOwnPropertyDescriptors,al=Object.getOwnPropertySymbols,__=Object.prototype.hasOwnProperty,b_=Object.prototype.propertyIsEnumerable,ol=(o,t,r)=>t in o?v_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,E_=(o,t)=>{for(var r in t||(t={}))__.call(t,r)&&ol(o,r,t[r]);if(al)for(var r of al(t))b_.call(t,r)&&ol(o,r,t[r]);return o},I_=(o,t)=>m_(o,w_(t));function Ra(o){return I_(E_({},o),{level:(o==null?void 0:o.level)||y_.level})}function x_(o,t=en){return o[t]||""}function P_(o,t,r=en){return o[r]=t,o}function or(o,t=en){let r="";return typeof o.bindings>"u"?r=x_(o,t):r=o.bindings().context||"",r}function S_(o,t,r=en){const s=or(o,r);return s.trim()?`${s}/${t}`:t}function cr(o,t,r=en){const s=S_(o,t,r),a=o.child({context:s});return P_(a,s,r)}class O_ extends ki{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let R_=class extends ki{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},A_=class{constructor(t,r){this.logger=t,this.core=r}},C_=class extends ki{constructor(t,r){super(),this.relayer=t,this.logger=r}},T_=class extends ki{constructor(t){super()}},$_=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class N_ extends ki{constructor(t,r){super(),this.relayer=t,this.logger=r}}let D_=class extends ki{constructor(t,r){super(),this.core=t,this.logger=r}},q_=class{constructor(t,r){this.projectId=t,this.logger=r}},L_=class{constructor(t,r){this.projectId=t,this.logger=r}},j_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},z_=class{constructor(t){this.client=t}};var zc={},of={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var t=u0,r=Vl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(m,g){if(g===void 0&&(g=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&g>0;)this._buffer[this._bufferLength++]=m[_++],g--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(_=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,_,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=m[_++],g--;return this},y.prototype.finish=function(m){if(!this._finished){var g=this._bytesHashed,_=this._bufferLength,S=g/536870912|0,R=g<<3,D=g%128<112?128:256;this._buffer[_]=128;for(var C=_+1;C<D-8;C++)this._buffer[C]=0;t.writeUint32BE(S,this._buffer,D-8),t.writeUint32BE(R,this._buffer,D-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,D),this._finished=!0}for(var C=0;C<this.digestLength/8;C++)t.writeUint32BE(this._stateHi[C],m,C*8),t.writeUint32BE(this._stateLo[C],m,C*8+4);return this},y.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(m){r.wipe(m.stateHi),r.wipe(m.stateLo),m.buffer&&r.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},y}();o.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(y,m,g,_,S,R,D){for(var C=g[0],Z=g[1],se=g[2],ne=g[3],ce=g[4],ae=g[5],te=g[6],fe=g[7],pe=_[0],Q=_[1],xe=_[2],Tt=_[3],yt=_[4],Yt=_[5],Vt=_[6],ur=_[7],M,U,Ge,qe,G,K,H,V;D>=128;){for(var Ot=0;Ot<16;Ot++){var rt=8*Ot+R;y[Ot]=t.readUint32BE(S,rt),m[Ot]=t.readUint32BE(S,rt+4)}for(var Ot=0;Ot<80;Ot++){var xi=C,we=Z,Or=se,$=ne,T=ce,O=ae,h=te,E=fe,J=pe,oe=Q,ge=xe,Pe=Tt,Oe=yt,_e=Yt,vt=Vt,lt=ur;if(M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(ce>>>14|yt<<18)^(ce>>>18|yt<<14)^(yt>>>9|ce<<23),U=(yt>>>14|ce<<18)^(yt>>>18|ce<<14)^(ce>>>9|yt<<23),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=ce&ae^~ce&te,U=yt&Yt^~yt&Vt,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=a[Ot*2],U=a[Ot*2+1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=y[Ot%16],U=m[Ot%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,Ge=H&65535|V<<16,qe=G&65535|K<<16,M=Ge,U=qe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(C>>>28|pe<<4)^(pe>>>2|C<<30)^(pe>>>7|C<<25),U=(pe>>>28|C<<4)^(C>>>2|pe<<30)^(C>>>7|pe<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=C&Z^C&se^Z&se,U=pe&Q^pe&xe^Q&xe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,E=H&65535|V<<16,lt=G&65535|K<<16,M=$,U=Pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=Ge,U=qe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,$=H&65535|V<<16,Pe=G&65535|K<<16,Z=xi,se=we,ne=Or,ce=$,ae=T,te=O,fe=h,C=E,Q=J,xe=oe,Tt=ge,yt=Pe,Yt=Oe,Vt=_e,ur=vt,pe=lt,Ot%16===15)for(var rt=0;rt<16;rt++)M=y[rt],U=m[rt],G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=y[(rt+9)%16],U=m[(rt+9)%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+1)%16],qe=m[(rt+1)%16],M=(Ge>>>1|qe<<31)^(Ge>>>8|qe<<24)^Ge>>>7,U=(qe>>>1|Ge<<31)^(qe>>>8|Ge<<24)^(qe>>>7|Ge<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+14)%16],qe=m[(rt+14)%16],M=(Ge>>>19|qe<<13)^(qe>>>29|Ge<<3)^Ge>>>6,U=(qe>>>19|Ge<<13)^(Ge>>>29|qe<<3)^(qe>>>6|Ge<<26),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,y[rt]=H&65535|V<<16,m[rt]=G&65535|K<<16}M=C,U=pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[0],U=_[0],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[0]=C=H&65535|V<<16,_[0]=pe=G&65535|K<<16,M=Z,U=Q,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[1],U=_[1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[1]=Z=H&65535|V<<16,_[1]=Q=G&65535|K<<16,M=se,U=xe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[2],U=_[2],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[2]=se=H&65535|V<<16,_[2]=xe=G&65535|K<<16,M=ne,U=Tt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[3],U=_[3],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[3]=ne=H&65535|V<<16,_[3]=Tt=G&65535|K<<16,M=ce,U=yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[4],U=_[4],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[4]=ce=H&65535|V<<16,_[4]=yt=G&65535|K<<16,M=ae,U=Yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[5],U=_[5],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[5]=ae=H&65535|V<<16,_[5]=Yt=G&65535|K<<16,M=te,U=Vt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[6],U=_[6],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[6]=te=H&65535|V<<16,_[6]=Vt=G&65535|K<<16,M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[7],U=_[7],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[7]=fe=H&65535|V<<16,_[7]=ur=G&65535|K<<16,R+=128,D-=128}return R}function f(y){var m=new s;m.update(y);var g=m.digest();return m.clean(),g}o.hash=f})(of);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const t=Fl,r=of,s=Vl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a($){const T=new Float64Array(16);if($)for(let O=0;O<$.length;O++)T[O]=$[O];return T}const u=new Uint8Array(32);u[0]=9;const f=a(),y=a([1]),m=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function D($,T){for(let O=0;O<16;O++)$[O]=T[O]|0}function C($){let T=1;for(let O=0;O<16;O++){let h=$[O]+T+65535;T=Math.floor(h/65536),$[O]=h-T*65536}$[0]+=T-1+37*(T-1)}function Z($,T,O){const h=~(O-1);for(let E=0;E<16;E++){const J=h&($[E]^T[E]);$[E]^=J,T[E]^=J}}function se($,T){const O=a(),h=a();for(let E=0;E<16;E++)h[E]=T[E];C(h),C(h),C(h);for(let E=0;E<2;E++){O[0]=h[0]-65517;for(let oe=1;oe<15;oe++)O[oe]=h[oe]-65535-(O[oe-1]>>16&1),O[oe-1]&=65535;O[15]=h[15]-32767-(O[14]>>16&1);const J=O[15]>>16&1;O[14]&=65535,Z(h,O,1-J)}for(let E=0;E<16;E++)$[2*E]=h[E]&255,$[2*E+1]=h[E]>>8}function ne($,T){let O=0;for(let h=0;h<32;h++)O|=$[h]^T[h];return(1&O-1>>>8)-1}function ce($,T){const O=new Uint8Array(32),h=new Uint8Array(32);return se(O,$),se(h,T),ne(O,h)}function ae($){const T=new Uint8Array(32);return se(T,$),T[0]&1}function te($,T){for(let O=0;O<16;O++)$[O]=T[2*O]+(T[2*O+1]<<8);$[15]&=32767}function fe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]+O[h]}function pe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]-O[h]}function Q($,T,O){let h,E,J=0,oe=0,ge=0,Pe=0,Oe=0,_e=0,vt=0,lt=0,Ze=0,Ae=0,ke=0,Ke=0,Xe=0,Ne=0,Ve=0,Se=0,Le=0,it=0,Te=0,mt=0,Rt=0,Lt=0,jt=0,$t=0,Ft=0,Zt=0,jr=0,Bt=0,Fr=0,ai=0,Pi=0,st=O[0],We=O[1],nt=O[2],at=O[3],et=O[4],Je=O[5],wt=O[6],_t=O[7],ot=O[8],bt=O[9],ct=O[10],ft=O[11],ut=O[12],He=O[13],Et=O[14],It=O[15];h=T[0],J+=h*st,oe+=h*We,ge+=h*nt,Pe+=h*at,Oe+=h*et,_e+=h*Je,vt+=h*wt,lt+=h*_t,Ze+=h*ot,Ae+=h*bt,ke+=h*ct,Ke+=h*ft,Xe+=h*ut,Ne+=h*He,Ve+=h*Et,Se+=h*It,h=T[1],oe+=h*st,ge+=h*We,Pe+=h*nt,Oe+=h*at,_e+=h*et,vt+=h*Je,lt+=h*wt,Ze+=h*_t,Ae+=h*ot,ke+=h*bt,Ke+=h*ct,Xe+=h*ft,Ne+=h*ut,Ve+=h*He,Se+=h*Et,Le+=h*It,h=T[2],ge+=h*st,Pe+=h*We,Oe+=h*nt,_e+=h*at,vt+=h*et,lt+=h*Je,Ze+=h*wt,Ae+=h*_t,ke+=h*ot,Ke+=h*bt,Xe+=h*ct,Ne+=h*ft,Ve+=h*ut,Se+=h*He,Le+=h*Et,it+=h*It,h=T[3],Pe+=h*st,Oe+=h*We,_e+=h*nt,vt+=h*at,lt+=h*et,Ze+=h*Je,Ae+=h*wt,ke+=h*_t,Ke+=h*ot,Xe+=h*bt,Ne+=h*ct,Ve+=h*ft,Se+=h*ut,Le+=h*He,it+=h*Et,Te+=h*It,h=T[4],Oe+=h*st,_e+=h*We,vt+=h*nt,lt+=h*at,Ze+=h*et,Ae+=h*Je,ke+=h*wt,Ke+=h*_t,Xe+=h*ot,Ne+=h*bt,Ve+=h*ct,Se+=h*ft,Le+=h*ut,it+=h*He,Te+=h*Et,mt+=h*It,h=T[5],_e+=h*st,vt+=h*We,lt+=h*nt,Ze+=h*at,Ae+=h*et,ke+=h*Je,Ke+=h*wt,Xe+=h*_t,Ne+=h*ot,Ve+=h*bt,Se+=h*ct,Le+=h*ft,it+=h*ut,Te+=h*He,mt+=h*Et,Rt+=h*It,h=T[6],vt+=h*st,lt+=h*We,Ze+=h*nt,Ae+=h*at,ke+=h*et,Ke+=h*Je,Xe+=h*wt,Ne+=h*_t,Ve+=h*ot,Se+=h*bt,Le+=h*ct,it+=h*ft,Te+=h*ut,mt+=h*He,Rt+=h*Et,Lt+=h*It,h=T[7],lt+=h*st,Ze+=h*We,Ae+=h*nt,ke+=h*at,Ke+=h*et,Xe+=h*Je,Ne+=h*wt,Ve+=h*_t,Se+=h*ot,Le+=h*bt,it+=h*ct,Te+=h*ft,mt+=h*ut,Rt+=h*He,Lt+=h*Et,jt+=h*It,h=T[8],Ze+=h*st,Ae+=h*We,ke+=h*nt,Ke+=h*at,Xe+=h*et,Ne+=h*Je,Ve+=h*wt,Se+=h*_t,Le+=h*ot,it+=h*bt,Te+=h*ct,mt+=h*ft,Rt+=h*ut,Lt+=h*He,jt+=h*Et,$t+=h*It,h=T[9],Ae+=h*st,ke+=h*We,Ke+=h*nt,Xe+=h*at,Ne+=h*et,Ve+=h*Je,Se+=h*wt,Le+=h*_t,it+=h*ot,Te+=h*bt,mt+=h*ct,Rt+=h*ft,Lt+=h*ut,jt+=h*He,$t+=h*Et,Ft+=h*It,h=T[10],ke+=h*st,Ke+=h*We,Xe+=h*nt,Ne+=h*at,Ve+=h*et,Se+=h*Je,Le+=h*wt,it+=h*_t,Te+=h*ot,mt+=h*bt,Rt+=h*ct,Lt+=h*ft,jt+=h*ut,$t+=h*He,Ft+=h*Et,Zt+=h*It,h=T[11],Ke+=h*st,Xe+=h*We,Ne+=h*nt,Ve+=h*at,Se+=h*et,Le+=h*Je,it+=h*wt,Te+=h*_t,mt+=h*ot,Rt+=h*bt,Lt+=h*ct,jt+=h*ft,$t+=h*ut,Ft+=h*He,Zt+=h*Et,jr+=h*It,h=T[12],Xe+=h*st,Ne+=h*We,Ve+=h*nt,Se+=h*at,Le+=h*et,it+=h*Je,Te+=h*wt,mt+=h*_t,Rt+=h*ot,Lt+=h*bt,jt+=h*ct,$t+=h*ft,Ft+=h*ut,Zt+=h*He,jr+=h*Et,Bt+=h*It,h=T[13],Ne+=h*st,Ve+=h*We,Se+=h*nt,Le+=h*at,it+=h*et,Te+=h*Je,mt+=h*wt,Rt+=h*_t,Lt+=h*ot,jt+=h*bt,$t+=h*ct,Ft+=h*ft,Zt+=h*ut,jr+=h*He,Bt+=h*Et,Fr+=h*It,h=T[14],Ve+=h*st,Se+=h*We,Le+=h*nt,it+=h*at,Te+=h*et,mt+=h*Je,Rt+=h*wt,Lt+=h*_t,jt+=h*ot,$t+=h*bt,Ft+=h*ct,Zt+=h*ft,jr+=h*ut,Bt+=h*He,Fr+=h*Et,ai+=h*It,h=T[15],Se+=h*st,Le+=h*We,it+=h*nt,Te+=h*at,mt+=h*et,Rt+=h*Je,Lt+=h*wt,jt+=h*_t,$t+=h*ot,Ft+=h*bt,Zt+=h*ct,jr+=h*ft,Bt+=h*ut,Fr+=h*He,ai+=h*Et,Pi+=h*It,J+=38*Le,oe+=38*it,ge+=38*Te,Pe+=38*mt,Oe+=38*Rt,_e+=38*Lt,vt+=38*jt,lt+=38*$t,Ze+=38*Ft,Ae+=38*Zt,ke+=38*jr,Ke+=38*Bt,Xe+=38*Fr,Ne+=38*ai,Ve+=38*Pi,E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=oe+E+65535,E=Math.floor(h/65536),oe=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,h=_e+E+65535,E=Math.floor(h/65536),_e=h-E*65536,h=vt+E+65535,E=Math.floor(h/65536),vt=h-E*65536,h=lt+E+65535,E=Math.floor(h/65536),lt=h-E*65536,h=Ze+E+65535,E=Math.floor(h/65536),Ze=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=ke+E+65535,E=Math.floor(h/65536),ke=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Xe+E+65535,E=Math.floor(h/65536),Xe=h-E*65536,h=Ne+E+65535,E=Math.floor(h/65536),Ne=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,J+=E-1+37*(E-1),E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=oe+E+65535,E=Math.floor(h/65536),oe=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,h=_e+E+65535,E=Math.floor(h/65536),_e=h-E*65536,h=vt+E+65535,E=Math.floor(h/65536),vt=h-E*65536,h=lt+E+65535,E=Math.floor(h/65536),lt=h-E*65536,h=Ze+E+65535,E=Math.floor(h/65536),Ze=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=ke+E+65535,E=Math.floor(h/65536),ke=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Xe+E+65535,E=Math.floor(h/65536),Xe=h-E*65536,h=Ne+E+65535,E=Math.floor(h/65536),Ne=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,J+=E-1+37*(E-1),$[0]=J,$[1]=oe,$[2]=ge,$[3]=Pe,$[4]=Oe,$[5]=_e,$[6]=vt,$[7]=lt,$[8]=Ze,$[9]=Ae,$[10]=ke,$[11]=Ke,$[12]=Xe,$[13]=Ne,$[14]=Ve,$[15]=Se}function xe($,T){Q($,T,T)}function Tt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=253;h>=0;h--)xe(O,O),h!==2&&h!==4&&Q(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function yt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=250;h>=0;h--)xe(O,O),h!==1&&Q(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function Yt($,T){const O=a(),h=a(),E=a(),J=a(),oe=a(),ge=a(),Pe=a(),Oe=a(),_e=a();pe(O,$[1],$[0]),pe(_e,T[1],T[0]),Q(O,O,_e),fe(h,$[0],$[1]),fe(_e,T[0],T[1]),Q(h,h,_e),Q(E,$[3],T[3]),Q(E,E,g),Q(J,$[2],T[2]),fe(J,J,J),pe(oe,h,O),pe(ge,J,E),fe(Pe,J,E),fe(Oe,h,O),Q($[0],oe,ge),Q($[1],Oe,Pe),Q($[2],Pe,ge),Q($[3],oe,Oe)}function Vt($,T,O){for(let h=0;h<4;h++)Z($[h],T[h],O)}function ur($,T){const O=a(),h=a(),E=a();Tt(E,T[2]),Q(O,T[0],E),Q(h,T[1],E),se($,h),$[31]^=ae(O)<<7}function M($,T,O){D($[0],f),D($[1],y),D($[2],y),D($[3],f);for(let h=255;h>=0;--h){const E=O[h/8|0]>>(h&7)&1;Vt($,T,E),Yt(T,$),Yt($,$),Vt($,T,E)}}function U($,T){const O=[a(),a(),a(),a()];D(O[0],_),D(O[1],S),D(O[2],y),Q(O[3],_,S),M($,O,T)}function Ge($){if($.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const T=(0,r.hash)($);T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(32),h=[a(),a(),a(),a()];U(h,T),ur(O,h);const E=new Uint8Array(64);return E.set($),E.set(O,32),{publicKey:O,secretKey:E}}o.generateKeyPairFromSeed=Ge;function qe($){const T=(0,t.randomBytes)(32,$),O=Ge(T);return(0,s.wipe)(T),O}o.generateKeyPair=qe;function G($){if($.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array($.subarray(32))}o.extractPublicKeyFromSecretKey=G;const K=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function H($,T){let O,h,E,J;for(h=63;h>=32;--h){for(O=0,E=h-32,J=h-12;E<J;++E)T[E]+=O-16*T[h]*K[E-(h-32)],O=Math.floor((T[E]+128)/256),T[E]-=O*256;T[E]+=O,T[h]=0}for(O=0,E=0;E<32;E++)T[E]+=O-(T[31]>>4)*K[E],O=T[E]>>8,T[E]&=255;for(E=0;E<32;E++)T[E]-=O*K[E];for(h=0;h<32;h++)T[h+1]+=T[h]>>8,$[h]=T[h]&255}function V($){const T=new Float64Array(64);for(let O=0;O<64;O++)T[O]=$[O];for(let O=0;O<64;O++)$[O]=0;H($,T)}function Ot($,T){const O=new Float64Array(64),h=[a(),a(),a(),a()],E=(0,r.hash)($.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const J=new Uint8Array(64);J.set(E.subarray(32),32);const oe=new r.SHA512;oe.update(J.subarray(32)),oe.update(T);const ge=oe.digest();oe.clean(),V(ge),U(h,ge),ur(J,h),oe.reset(),oe.update(J.subarray(0,32)),oe.update($.subarray(32)),oe.update(T);const Pe=oe.digest();V(Pe);for(let Oe=0;Oe<32;Oe++)O[Oe]=ge[Oe];for(let Oe=0;Oe<32;Oe++)for(let _e=0;_e<32;_e++)O[Oe+_e]+=Pe[Oe]*E[_e];return H(J.subarray(32),O),J}o.sign=Ot;function rt($,T){const O=a(),h=a(),E=a(),J=a(),oe=a(),ge=a(),Pe=a();return D($[2],y),te($[1],T),xe(E,$[1]),Q(J,E,m),pe(E,E,$[2]),fe(J,$[2],J),xe(oe,J),xe(ge,oe),Q(Pe,ge,oe),Q(O,Pe,E),Q(O,O,J),yt(O,O),Q(O,O,E),Q(O,O,J),Q(O,O,J),Q($[0],O,J),xe(h,$[0]),Q(h,h,J),ce(h,E)&&Q($[0],$[0],R),xe(h,$[0]),Q(h,h,J),ce(h,E)?-1:(ae($[0])===T[31]>>7&&pe($[0],f,$[0]),Q($[3],$[0],$[1]),0)}function xi($,T,O){const h=new Uint8Array(32),E=[a(),a(),a(),a()],J=[a(),a(),a(),a()];if(O.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(rt(J,$))return!1;const oe=new r.SHA512;oe.update(O.subarray(0,32)),oe.update($),oe.update(T);const ge=oe.digest();return V(ge),M(E,J,ge),U(J,O.subarray(32)),Yt(E,J),ur(h,E),!ne(O,h)}o.verify=xi;function we($){let T=[a(),a(),a(),a()];if(rt(T,$))throw new Error("Ed25519: invalid public key");let O=a(),h=a(),E=T[1];fe(O,y,E),pe(h,y,E),Tt(h,h),Q(O,O,h);let J=new Uint8Array(32);return se(J,O),J}o.convertPublicKeyToX25519=we;function Or($){const T=(0,r.hash)($.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(T.subarray(0,32));return(0,s.wipe)(T),O}o.convertSecretKeyToX25519=Or})(zc);const M_="EdDSA",U_="JWT",cf=".",uf="base64url",H_="utf8",k_="utf8",K_=":",V_="did",F_="key",cl="base58btc",B_="z",G_="K36",W_=32;function wa(o){return Ea(Nc(Ys(o),H_),uf)}function hf(o){const t=Nc(G_,cl),r=B_+Ea(h0([t,o]),cl);return[V_,F_,r].join(K_)}function J_(o){return Ea(o,uf)}function Q_(o){return Nc([wa(o.header),wa(o.payload)].join(cf),k_)}function Y_(o){return[wa(o.header),wa(o.payload),J_(o.signature)].join(cf)}function ul(o=Fl.randomBytes(W_)){return zc.generateKeyPairFromSeed(o)}async function Z_(o,t,r,s,a=X.fromMiliseconds(Date.now())){const u={alg:M_,typ:U_},f=hf(s.publicKey),y=a+r,m={iss:f,sub:o,aud:t,iat:a,exp:y},g=Q_({header:u,payload:m}),_=zc.sign(s.secretKey,g);return Y_({header:u,payload:m,signature:_})}let X_=class extends Zl{constructor(t){super(t),this.events=new Sr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Ui(t.method,t.params||[],t.id||Dc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Lr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Zs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const e1=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),t1=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",hl=o=>o.split("?")[0],ll=10,r1=e1();let i1=class{constructor(t){if(this.url=t,this.events=new Sr.EventEmitter,this.registering=!1,!Jh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ys(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Jh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),u=Y0.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!Z0(t)},f=new r1(t,[],u);t1()?f.onerror=y=>{const m=y;s(this.emitError(m.error))}:f.on("error",y=>{s(this.emitError(y))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Ia(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=qc(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return X0(t,hl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ll&&this.events.setMaxListeners(ll)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${hl(this.url)}`));return this.events.emit("register_error",r),r}};var _a={exports:{}};_a.exports;(function(o,t){var r=200,s="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,y="[object Arguments]",m="[object Array]",g="[object AsyncFunction]",_="[object Boolean]",S="[object Date]",R="[object Error]",D="[object Function]",C="[object GeneratorFunction]",Z="[object Map]",se="[object Number]",ne="[object Null]",ce="[object Object]",ae="[object Promise]",te="[object Proxy]",fe="[object RegExp]",pe="[object Set]",Q="[object String]",xe="[object Symbol]",Tt="[object Undefined]",yt="[object WeakMap]",Yt="[object ArrayBuffer]",Vt="[object DataView]",ur="[object Float32Array]",M="[object Float64Array]",U="[object Int8Array]",Ge="[object Int16Array]",qe="[object Int32Array]",G="[object Uint8Array]",K="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",Ot=/[\\^$.*+?()[\]{}|]/g,rt=/^\[object .+?Constructor\]$/,xi=/^(?:0|[1-9]\d*)$/,we={};we[ur]=we[M]=we[U]=we[Ge]=we[qe]=we[G]=we[K]=we[H]=we[V]=!0,we[y]=we[m]=we[Yt]=we[_]=we[Vt]=we[S]=we[R]=we[D]=we[Z]=we[se]=we[ce]=we[fe]=we[pe]=we[Q]=we[yt]=!1;var Or=typeof oa=="object"&&oa&&oa.Object===Object&&oa,$=typeof self=="object"&&self&&self.Object===Object&&self,T=Or||$||Function("return this")(),O=t&&!t.nodeType&&t,h=O&&!0&&o&&!o.nodeType&&o,E=h&&h.exports===O,J=E&&Or.process,oe=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),ge=oe&&oe.isTypedArray;function Pe(v,I){for(var j=-1,F=v==null?0:v.length,ze=0,he=[];++j<F;){var Fe=v[j];I(Fe,j,v)&&(he[ze++]=Fe)}return he}function Oe(v,I){for(var j=-1,F=I.length,ze=v.length;++j<F;)v[ze+j]=I[j];return v}function _e(v,I){for(var j=-1,F=v==null?0:v.length;++j<F;)if(I(v[j],j,v))return!0;return!1}function vt(v,I){for(var j=-1,F=Array(v);++j<v;)F[j]=I(j);return F}function lt(v){return function(I){return v(I)}}function Ze(v,I){return v.has(I)}function Ae(v,I){return v==null?void 0:v[I]}function ke(v){var I=-1,j=Array(v.size);return v.forEach(function(F,ze){j[++I]=[ze,F]}),j}function Ke(v,I){return function(j){return v(I(j))}}function Xe(v){var I=-1,j=Array(v.size);return v.forEach(function(F){j[++I]=F}),j}var Ne=Array.prototype,Ve=Function.prototype,Se=Object.prototype,Le=T["__core-js_shared__"],it=Ve.toString,Te=Se.hasOwnProperty,mt=function(){var v=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Rt=Se.toString,Lt=RegExp("^"+it.call(Te).replace(Ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jt=E?T.Buffer:void 0,$t=T.Symbol,Ft=T.Uint8Array,Zt=Se.propertyIsEnumerable,jr=Ne.splice,Bt=$t?$t.toStringTag:void 0,Fr=Object.getOwnPropertySymbols,ai=jt?jt.isBuffer:void 0,Pi=Ke(Object.keys,Object),st=hr(T,"DataView"),We=hr(T,"Map"),nt=hr(T,"Promise"),at=hr(T,"Set"),et=hr(T,"WeakMap"),Je=hr(Object,"create"),wt=Gr(st),_t=Gr(We),ot=Gr(nt),bt=Gr(at),ct=Gr(et),ft=$t?$t.prototype:void 0,ut=ft?ft.valueOf:void 0;function He(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Et(){this.__data__=Je?Je(null):{},this.size=0}function It(v){var I=this.has(v)&&delete this.__data__[v];return this.size-=I?1:0,I}function Ta(v){var I=this.__data__;if(Je){var j=I[v];return j===s?void 0:j}return Te.call(I,v)?I[v]:void 0}function $a(v){var I=this.__data__;return Je?I[v]!==void 0:Te.call(I,v)}function Na(v,I){var j=this.__data__;return this.size+=this.has(v)?0:1,j[v]=Je&&I===void 0?s:I,this}He.prototype.clear=Et,He.prototype.delete=It,He.prototype.get=Ta,He.prototype.has=$a,He.prototype.set=Na;function yr(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Da(){this.__data__=[],this.size=0}function qa(v){var I=this.__data__,j=Si(I,v);if(j<0)return!1;var F=I.length-1;return j==F?I.pop():jr.call(I,j,1),--this.size,!0}function La(v){var I=this.__data__,j=Si(I,v);return j<0?void 0:I[j][1]}function ja(v){return Si(this.__data__,v)>-1}function za(v,I){var j=this.__data__,F=Si(j,v);return F<0?(++this.size,j.push([v,I])):j[F][1]=I,this}yr.prototype.clear=Da,yr.prototype.delete=qa,yr.prototype.get=La,yr.prototype.has=ja,yr.prototype.set=za;function Br(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Vi(){this.size=0,this.__data__={hash:new He,map:new(We||yr),string:new He}}function Ma(v){var I=oi(this,v).delete(v);return this.size-=I?1:0,I}function Fi(v){return oi(this,v).get(v)}function Ua(v){return oi(this,v).has(v)}function Ha(v,I){var j=oi(this,v),F=j.size;return j.set(v,I),this.size+=j.size==F?0:1,this}Br.prototype.clear=Vi,Br.prototype.delete=Ma,Br.prototype.get=Fi,Br.prototype.has=Ua,Br.prototype.set=Ha;function Bi(v){var I=-1,j=v==null?0:v.length;for(this.__data__=new Br;++I<j;)this.add(v[I])}function rn(v){return this.__data__.set(v,s),this}function sn(v){return this.__data__.has(v)}Bi.prototype.add=Bi.prototype.push=rn,Bi.prototype.has=sn;function Rr(v){var I=this.__data__=new yr(v);this.size=I.size}function ka(){this.__data__=new yr,this.size=0}function Ka(v){var I=this.__data__,j=I.delete(v);return this.size=I.size,j}function Va(v){return this.__data__.get(v)}function Fa(v){return this.__data__.has(v)}function nn(v,I){var j=this.__data__;if(j instanceof yr){var F=j.__data__;if(!We||F.length<r-1)return F.push([v,I]),this.size=++j.size,this;j=this.__data__=new Br(F)}return j.set(v,I),this.size=j.size,this}Rr.prototype.clear=ka,Rr.prototype.delete=Ka,Rr.prototype.get=Va,Rr.prototype.has=Fa,Rr.prototype.set=nn;function an(v,I){var j=Ji(v),F=!j&&mn(v),ze=!j&&!F&&_s(v),he=!j&&!F&&!ze&&bn(v),Fe=j||F||ze||he,xt=Fe?vt(v.length,String):[],Ee=xt.length;for(var Me in v)Te.call(v,Me)&&!(Fe&&(Me=="length"||ze&&(Me=="offset"||Me=="parent")||he&&(Me=="buffer"||Me=="byteLength"||Me=="byteOffset")||pn(Me,Ee)))&&xt.push(Me);return xt}function Si(v,I){for(var j=v.length;j--;)if(vn(v[j][0],I))return j;return-1}function ms(v,I,j){var F=I(v);return Ji(v)?F:Oe(F,j(v))}function Oi(v){return v==null?v===void 0?Tt:ne:Bt&&Bt in Object(v)?ln(v):Wa(v)}function ws(v){return Ai(v)&&Oi(v)==y}function Ri(v,I,j,F,ze){return v===I?!0:v==null||I==null||!Ai(v)&&!Ai(I)?v!==v&&I!==I:on(v,I,j,F,Ri,ze)}function on(v,I,j,F,ze,he){var Fe=Ji(v),xt=Ji(I),Ee=Fe?m:zr(v),Me=xt?m:zr(I);Ee=Ee==y?ce:Ee,Me=Me==y?ce:Me;var pt=Ee==ce,Xt=Me==ce,Pt=Ee==Me;if(Pt&&_s(v)){if(!_s(I))return!1;Fe=!0,pt=!1}if(Pt&&!pt)return he||(he=new Rr),Fe||bn(v)?Gi(v,I,j,F,ze,he):Ga(v,I,Ee,j,F,ze,he);if(!(j&a)){var Be=pt&&Te.call(v,"__wrapped__"),Gt=Xt&&Te.call(I,"__wrapped__");if(Be||Gt){var Ar=Be?v.value():v,vr=Gt?I.value():I;return he||(he=new Rr),ze(Ar,vr,j,F,he)}}return Pt?(he||(he=new Rr),hn(v,I,j,F,ze,he)):!1}function Ba(v){if(!_n(v)||gn(v))return!1;var I=Qi(v)?Lt:rt;return I.test(Gr(v))}function cn(v){return Ai(v)&&wn(v.length)&&!!we[Oi(v)]}function un(v){if(!yn(v))return Pi(v);var I=[];for(var j in Object(v))Te.call(v,j)&&j!="constructor"&&I.push(j);return I}function Gi(v,I,j,F,ze,he){var Fe=j&a,xt=v.length,Ee=I.length;if(xt!=Ee&&!(Fe&&Ee>xt))return!1;var Me=he.get(v);if(Me&&he.get(I))return Me==I;var pt=-1,Xt=!0,Pt=j&u?new Bi:void 0;for(he.set(v,I),he.set(I,v);++pt<xt;){var Be=v[pt],Gt=I[pt];if(F)var Ar=Fe?F(Gt,Be,pt,I,v,he):F(Be,Gt,pt,v,I,he);if(Ar!==void 0){if(Ar)continue;Xt=!1;break}if(Pt){if(!_e(I,function(vr,Mr){if(!Ze(Pt,Mr)&&(Be===vr||ze(Be,vr,j,F,he)))return Pt.push(Mr)})){Xt=!1;break}}else if(!(Be===Gt||ze(Be,Gt,j,F,he))){Xt=!1;break}}return he.delete(v),he.delete(I),Xt}function Ga(v,I,j,F,ze,he,Fe){switch(j){case Vt:if(v.byteLength!=I.byteLength||v.byteOffset!=I.byteOffset)return!1;v=v.buffer,I=I.buffer;case Yt:return!(v.byteLength!=I.byteLength||!he(new Ft(v),new Ft(I)));case _:case S:case se:return vn(+v,+I);case R:return v.name==I.name&&v.message==I.message;case fe:case Q:return v==I+"";case Z:var xt=ke;case pe:var Ee=F&a;if(xt||(xt=Xe),v.size!=I.size&&!Ee)return!1;var Me=Fe.get(v);if(Me)return Me==I;F|=u,Fe.set(v,I);var pt=Gi(xt(v),xt(I),F,ze,he,Fe);return Fe.delete(v),pt;case xe:if(ut)return ut.call(v)==ut.call(I)}return!1}function hn(v,I,j,F,ze,he){var Fe=j&a,xt=Wi(v),Ee=xt.length,Me=Wi(I),pt=Me.length;if(Ee!=pt&&!Fe)return!1;for(var Xt=Ee;Xt--;){var Pt=xt[Xt];if(!(Fe?Pt in I:Te.call(I,Pt)))return!1}var Be=he.get(v);if(Be&&he.get(I))return Be==I;var Gt=!0;he.set(v,I),he.set(I,v);for(var Ar=Fe;++Xt<Ee;){Pt=xt[Xt];var vr=v[Pt],Mr=I[Pt];if(F)var bs=Fe?F(Mr,vr,Pt,I,v,he):F(vr,Mr,Pt,v,I,he);if(!(bs===void 0?vr===Mr||ze(vr,Mr,j,F,he):bs)){Gt=!1;break}Ar||(Ar=Pt=="constructor")}if(Gt&&!Ar){var Ci=v.constructor,Nt=I.constructor;Ci!=Nt&&"constructor"in v&&"constructor"in I&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof Nt=="function"&&Nt instanceof Nt)&&(Gt=!1)}return he.delete(v),he.delete(I),Gt}function Wi(v){return ms(v,Ya,fn)}function oi(v,I){var j=v.__data__;return dn(I)?j[typeof I=="string"?"string":"hash"]:j.map}function hr(v,I){var j=Ae(v,I);return Ba(j)?j:void 0}function ln(v){var I=Te.call(v,Bt),j=v[Bt];try{v[Bt]=void 0;var F=!0}catch{}var ze=Rt.call(v);return F&&(I?v[Bt]=j:delete v[Bt]),ze}var fn=Fr?function(v){return v==null?[]:(v=Object(v),Pe(Fr(v),function(I){return Zt.call(v,I)}))}:je,zr=Oi;(st&&zr(new st(new ArrayBuffer(1)))!=Vt||We&&zr(new We)!=Z||nt&&zr(nt.resolve())!=ae||at&&zr(new at)!=pe||et&&zr(new et)!=yt)&&(zr=function(v){var I=Oi(v),j=I==ce?v.constructor:void 0,F=j?Gr(j):"";if(F)switch(F){case wt:return Vt;case _t:return Z;case ot:return ae;case bt:return pe;case ct:return yt}return I});function pn(v,I){return I=I??f,!!I&&(typeof v=="number"||xi.test(v))&&v>-1&&v%1==0&&v<I}function dn(v){var I=typeof v;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?v!=="__proto__":v===null}function gn(v){return!!mt&&mt in v}function yn(v){var I=v&&v.constructor,j=typeof I=="function"&&I.prototype||Se;return v===j}function Wa(v){return Rt.call(v)}function Gr(v){if(v!=null){try{return it.call(v)}catch{}try{return v+""}catch{}}return""}function vn(v,I){return v===I||v!==v&&I!==I}var mn=ws(function(){return arguments}())?ws:function(v){return Ai(v)&&Te.call(v,"callee")&&!Zt.call(v,"callee")},Ji=Array.isArray;function Ja(v){return v!=null&&wn(v.length)&&!Qi(v)}var _s=ai||De;function Qa(v,I){return Ri(v,I)}function Qi(v){if(!_n(v))return!1;var I=Oi(v);return I==D||I==C||I==g||I==te}function wn(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function _n(v){var I=typeof v;return v!=null&&(I=="object"||I=="function")}function Ai(v){return v!=null&&typeof v=="object"}var bn=ge?lt(ge):cn;function Ya(v){return Ja(v)?an(v):un(v)}function je(){return[]}function De(){return!1}o.exports=Qa})(_a,_a.exports);var s1=_a.exports;const n1=$c(s1);function a1(o,t){return t=t||{},new Promise(function(r,s){var a=new XMLHttpRequest,u=[],f=[],y={},m=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:m,headers:{keys:function(){return u},entries:function(){return f},get:function(_){return y[_.toLowerCase()]},has:function(_){return _.toLowerCase()in y}}}};for(var g in a.open(t.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,S,R){u.push(S=S.toLowerCase()),f.push([S,R]),y[S]=y[S]?y[S]+","+R:R}),r(m())},a.onerror=s,a.withCredentials=t.credentials=="include",t.headers)a.setRequestHeader(g,t.headers[g]);a.send(t.body||null)})}const o1=Object.freeze(Object.defineProperty({__proto__:null,default:a1},Symbol.toStringTag,{value:"Module"})),fl=Tc(o1);var c1=self.fetch||(self.fetch=fl.default||fl);const u1=$c(c1);var h1={};function l1(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),f=u.charCodeAt(0);if(r[f]!==255)throw new TypeError(u+" is ambiguous");r[f]=a}var y=o.length,m=o.charAt(0),g=Math.log(y)/Math.log(256),_=Math.log(256)/Math.log(y);function S(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var Z=0,se=0,ne=0,ce=C.length;ne!==ce&&C[ne]===0;)ne++,Z++;for(var ae=(ce-ne)*_+1>>>0,te=new Uint8Array(ae);ne!==ce;){for(var fe=C[ne],pe=0,Q=ae-1;(fe!==0||pe<se)&&Q!==-1;Q--,pe++)fe+=256*te[Q]>>>0,te[Q]=fe%y>>>0,fe=fe/y>>>0;if(fe!==0)throw new Error("Non-zero carry");se=pe,ne++}for(var xe=ae-se;xe!==ae&&te[xe]===0;)xe++;for(var Tt=m.repeat(Z);xe<ae;++xe)Tt+=o.charAt(te[xe]);return Tt}function R(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var Z=0;if(C[Z]!==" "){for(var se=0,ne=0;C[Z]===m;)se++,Z++;for(var ce=(C.length-Z)*g+1>>>0,ae=new Uint8Array(ce);C[Z];){var te=r[C.charCodeAt(Z)];if(te===255)return;for(var fe=0,pe=ce-1;(te!==0||fe<ne)&&pe!==-1;pe--,fe++)te+=y*ae[pe]>>>0,ae[pe]=te%256>>>0,te=te/256>>>0;if(te!==0)throw new Error("Non-zero carry");ne=fe,Z++}if(C[Z]!==" "){for(var Q=ce-ne;Q!==ce&&ae[Q]===0;)Q++;for(var xe=new Uint8Array(se+(ce-Q)),Tt=se;Q!==ce;)xe[Tt++]=ae[Q++];return xe}}}function D(C){var Z=R(C);if(Z)return Z;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:R,decode:D}}var f1=l1,p1=f1;const lf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},d1=o=>new TextEncoder().encode(o),g1=o=>new TextDecoder().decode(o);class y1{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class v1{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ff(this,t)}}class m1{constructor(t){this.decoders=t}or(t){return ff(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ff=(o,t)=>new m1({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class w1{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new y1(t,r,s),this.decoder=new v1(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Aa=({name:o,prefix:t,encode:r,decode:s})=>new w1(o,t,r,s),tn=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=p1(r,t);return Aa({prefix:o,name:t,encode:s,decode:u=>lf(a(u))})},_1=(o,t,r,s)=>{const a={};for(let _=0;_<t.length;++_)a[t[_]]=_;let u=o.length;for(;o[u-1]==="=";)--u;const f=new Uint8Array(u*r/8|0);let y=0,m=0,g=0;for(let _=0;_<u;++_){const S=a[o[_]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|S,y+=r,y>=8&&(y-=8,f[g++]=255&m>>y)}if(y>=r||255&m<<8-y)throw new SyntaxError("Unexpected end of data");return f},b1=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",f=0,y=0;for(let m=0;m<o.length;++m)for(y=y<<8|o[m],f+=8;f>r;)f-=r,u+=t[a&y>>f];if(f&&(u+=t[a&y<<r-f]),s)for(;u.length*r&7;)u+="=";return u},Mt=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>Aa({prefix:t,name:o,encode(a){return b1(a,s,r)},decode(a){return _1(a,s,r,o)}}),E1=Aa({prefix:"\0",name:"identity",encode:o=>g1(o),decode:o=>d1(o)});var I1=Object.freeze({__proto__:null,identity:E1});const x1=Mt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var P1=Object.freeze({__proto__:null,base2:x1});const S1=Mt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var O1=Object.freeze({__proto__:null,base8:S1});const R1=tn({prefix:"9",name:"base10",alphabet:"0123456789"});var A1=Object.freeze({__proto__:null,base10:R1});const C1=Mt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),T1=Mt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var $1=Object.freeze({__proto__:null,base16:C1,base16upper:T1});const N1=Mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D1=Mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),q1=Mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),L1=Mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),j1=Mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),z1=Mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),M1=Mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),U1=Mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),H1=Mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var k1=Object.freeze({__proto__:null,base32:N1,base32upper:D1,base32pad:q1,base32padupper:L1,base32hex:j1,base32hexupper:z1,base32hexpad:M1,base32hexpadupper:U1,base32z:H1});const K1=tn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),V1=tn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var F1=Object.freeze({__proto__:null,base36:K1,base36upper:V1});const B1=tn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),G1=tn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var W1=Object.freeze({__proto__:null,base58btc:B1,base58flickr:G1});const J1=Mt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Q1=Mt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Y1=Mt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Z1=Mt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var X1=Object.freeze({__proto__:null,base64:J1,base64pad:Q1,base64url:Y1,base64urlpad:Z1});const pf=Array.from(""),eb=pf.reduce((o,t,r)=>(o[r]=t,o),[]),tb=pf.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function rb(o){return o.reduce((t,r)=>(t+=eb[r],t),"")}function ib(o){const t=[];for(const r of o){const s=tb[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const sb=Aa({prefix:"",name:"base256emoji",encode:rb,decode:ib});var nb=Object.freeze({__proto__:null,base256emoji:sb}),ab=df,pl=128,ob=127,cb=~ob,ub=Math.pow(2,31);function df(o,t,r){t=t||[],r=r||0;for(var s=r;o>=ub;)t[r++]=o&255|pl,o/=128;for(;o&cb;)t[r++]=o&255|pl,o>>>=7;return t[r]=o|0,df.bytes=r-s+1,t}var hb=Pc,lb=128,dl=127;function Pc(o,s){var r=0,s=s||0,a=0,u=s,f,y=o.length;do{if(u>=y)throw Pc.bytes=0,new RangeError("Could not decode varint");f=o[u++],r+=a<28?(f&dl)<<a:(f&dl)*Math.pow(2,a),a+=7}while(f>=lb);return Pc.bytes=u-s,r}var fb=Math.pow(2,7),pb=Math.pow(2,14),db=Math.pow(2,21),gb=Math.pow(2,28),yb=Math.pow(2,35),vb=Math.pow(2,42),mb=Math.pow(2,49),wb=Math.pow(2,56),_b=Math.pow(2,63),bb=function(o){return o<fb?1:o<pb?2:o<db?3:o<gb?4:o<yb?5:o<vb?6:o<mb?7:o<wb?8:o<_b?9:10},Eb={encode:ab,decode:hb,encodingLength:bb},gf=Eb;const gl=(o,t,r=0)=>(gf.encode(o,t,r),t),yl=o=>gf.encodingLength(o),Sc=(o,t)=>{const r=t.byteLength,s=yl(o),a=s+yl(r),u=new Uint8Array(a+r);return gl(o,u,0),gl(r,u,s),u.set(t,a),new Ib(o,r,t,u)};class Ib{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const yf=({name:o,code:t,encode:r})=>new xb(o,t,r);class xb{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Sc(this.code,r):r.then(s=>Sc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const vf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),Pb=yf({name:"sha2-256",code:18,encode:vf("SHA-256")}),Sb=yf({name:"sha2-512",code:19,encode:vf("SHA-512")});var Ob=Object.freeze({__proto__:null,sha256:Pb,sha512:Sb});const mf=0,Rb="identity",wf=lf,Ab=o=>Sc(mf,wf(o)),Cb={code:mf,name:Rb,encode:wf,digest:Ab};var Tb=Object.freeze({__proto__:null,identity:Cb});new TextEncoder,new TextDecoder;const vl={...I1,...P1,...O1,...A1,...$1,...k1,...F1,...W1,...X1,...nb};({...Ob,...Tb});function _f(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function $b(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?_f(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function bf(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const ml=bf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),uc=bf("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=$b(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),Nb={utf8:ml,"utf-8":ml,hex:vl.base16,latin1:uc,ascii:uc,binary:uc,...vl};function Db(o,t="utf8"){const r=Nb[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?_f(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const Ef="wc",qb=2,Mc="core",_i=`${Ef}@2:${Mc}:`,Lb={name:Mc,logger:"error"},jb={database:":memory:"},zb="crypto",wl="client_ed25519_seed",Mb=X.ONE_DAY,Ub="keychain",Hb="0.3",kb="messages",Kb="0.3",Vb=X.SIX_HOURS,Fb="publisher",If="irn",Bb="error",xf="wss://relay.walletconnect.com",_l="wss://relay.walletconnect.org",Gb="relayer",Kt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Wb="_subscription",ii={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Jb=X.ONE_SECOND,Qb="2.11.0",Yb=1e4,Zb="0.3",Xb="WALLETCONNECT_CLIENT_ID",Dr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},eE="subscription",tE="0.3",rE=X.FIVE_SECONDS*1e3,iE="pairing",sE="0.3",Ms={wc_pairingDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:X.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:X.ONE_DAY,prompt:!1,tag:0},res:{ttl:X.ONE_DAY,prompt:!1,tag:0}}},Fs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},nE="history",aE="0.3",oE="expirer",Pr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},cE="0.3",hc="verify-api",ds="https://verify.walletconnect.com",Oc="https://verify.walletconnect.org",uE=[ds,Oc],hE="echo",lE="https://echo.walletconnect.com";class fE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=Ub,this.version=Hb,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=B("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Jl(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Ql(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class pE{constructor(t,r,s){this.core=t,this.logger=r,this.name=zb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=ul(a);return hf(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=p0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=ul(u),y=mc();return await Z_(y,a,Mb,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const y=this.getPrivateKey(a),m=d0(y,u);return this.setSymKey(m,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||g0(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const y=y0(f),m=Ys(u);if(Kh(y)){const R=y.senderPublicKey,D=y.receiverPublicKey;a=await this.generateSharedKey(R,D)}const g=this.getSymKey(a),{type:_,senderPublicKey:S}=y;return v0({type:_,symKey:g,message:m,senderPublicKey:S})},this.decode=async(a,u,f)=>{this.isInitialized();const y=m0(u,f);if(Kh(y)){const m=y.receiverPublicKey,g=y.senderPublicKey;a=await this.generateSharedKey(m,g)}try{const m=this.getSymKey(a),g=w0({symKey:m,encoded:u});return Ia(g)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const u=Vh(a);return _0(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Vh(a);return u.senderPublicKey?Ea(u.senderPublicKey,b0):void 0},this.core=t,this.logger=cr(r,this.name),this.keychain=s||new fE(this.core,this.logger)}get context(){return or(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(wl)}catch{t=mc(),await this.keychain.set(wl,t)}return Db(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class dE extends A_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=kb,this.version=Kb,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=gs(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(s,f),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),f=gs(a);return typeof u[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=cr(t,this.name),this.core=r}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Jl(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Ql(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class gE extends C_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Sr.EventEmitter,this.name=Fb,this.queue=new Map,this.publishTimeout=X.toMiliseconds(X.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const y=(u==null?void 0:u.ttl)||Vb,m=wc(u),g=(u==null?void 0:u.prompt)||!1,_=(u==null?void 0:u.tag)||0,S=(u==null?void 0:u.id)||Dc().toString(),R={topic:s,message:a,opts:{ttl:y,relay:m,prompt:g,tag:_,id:S}},D=setTimeout(()=>this.queue.set(S,R),this.publishTimeout);try{await await Gs(this.rpcPublish(s,a,y,m,g,_,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Kt.publish,R)}catch(C){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=u==null?void 0:u.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(S),C;return}finally{clearTimeout(D)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=cr(r,this.name),this.registerEventListeners()}get context(){return or(this.logger)}rpcPublish(t,r,s,a,u,f,y){var m,g,_,S;const R={method:ga(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:f},id:y};return wi((m=R.params)==null?void 0:m.prompt)&&((g=R.params)==null||delete g.prompt),wi((_=R.params)==null?void 0:_.tag)&&((S=R.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Kt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Kt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class yE{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var vE=Object.defineProperty,mE=Object.defineProperties,wE=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,_E=Object.prototype.hasOwnProperty,bE=Object.prototype.propertyIsEnumerable,El=(o,t,r)=>t in o?vE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Us=(o,t)=>{for(var r in t||(t={}))_E.call(t,r)&&El(o,r,t[r]);if(bl)for(var r of bl(t))bE.call(t,r)&&El(o,r,t[r]);return o},lc=(o,t)=>mE(o,wE(t));class EE extends N_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new yE,this.events=new Sr.EventEmitter,this.name=eE,this.version=tE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=_i,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=wc(a),f={topic:s,relay:u};this.pending.set(s,f);const y=await this.rpcSubscribe(s,u);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),y}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const f=new X.Watch;f.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=rE&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=cr(r,this.name),this.clientId=""}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=wc(s);await this.rpcUnsubscribe(t,r,a);const u=kt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:ga(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Gs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}return gs(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:ga(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Gs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:ga(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,lc(Us({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Us({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Us({},r)),this.topicMap.set(r.topic,t),this.events.emit(Dr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Dr.deleted,lc(Us({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Dr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);ys(r)&&this.onBatchSubscribe(r.map((s,a)=>lc(Us({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Kt.connect,async()=>{await this.onConnect()}),this.relayer.on(Kt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dr.created,async t=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Dr.deleted,async t=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var IE=Object.defineProperty,Il=Object.getOwnPropertySymbols,xE=Object.prototype.hasOwnProperty,PE=Object.prototype.propertyIsEnumerable,xl=(o,t,r)=>t in o?IE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,SE=(o,t)=>{for(var r in t||(t={}))xE.call(t,r)&&xl(o,r,t[r]);if(Il)for(var r of Il(t))PE.call(t,r)&&xl(o,r,t[r]);return o};class OE extends T_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Sr.EventEmitter,this.name=Gb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Kt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Kt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ii.payload,this.onPayloadHandler),this.provider.on(ii.connect,this.onConnectHandler),this.provider.on(ii.disconnect,this.onDisconnectHandler),this.provider.on(ii.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?cr(t.logger,this.name):Oa(Ra({level:t.logger||Bb})),this.messages=new dE(this.logger,t.core),this.subscriber=new EE(this,this.logger),this.publisher=new gE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||xf,this.projectId=t.projectId,this.bundleId=E0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${_l}...`),await this.restartTransport(_l)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Yb)}get context(){return or(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const f=y=>{y.topic===t&&(this.subscriber.off(Dr.created,f),u())};return await Promise.all([new Promise(y=>{u=y,this.subscriber.on(Dr.created,f)}),new Promise(async y=>{a=await this.subscriber.subscribe(t,r),y()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Gs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Dr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Gs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ii.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Fh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new X_(new i1(I0({sdkVersion:Qb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Lc(t)){if(!t.method.endsWith(Wb))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,f={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(SE({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else Zs(t)&&this.events.emit(Kt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Kt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=xa(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ii.payload,this.onPayloadHandler),this.provider.off(ii.connect,this.onConnectHandler),this.provider.off(ii.disconnect,this.onDisconnectHandler),this.provider.off(ii.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Kt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Fh();x0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Kt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},X.toMiliseconds(Jb)))}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var RE=Object.defineProperty,Pl=Object.getOwnPropertySymbols,AE=Object.prototype.hasOwnProperty,CE=Object.prototype.propertyIsEnumerable,Sl=(o,t,r)=>t in o?RE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Ol=(o,t)=>{for(var r in t||(t={}))AE.call(t,r)&&Sl(o,r,t[r]);if(Pl)for(var r of Pl(t))CE.call(t,r)&&Sl(o,r,t[r]);return o};class Ca extends $_{constructor(t,r,s,a=_i,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=Zb,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!wi(f)?this.map.set(this.getKey(f),f):l0(f)?this.map.set(f.id,f):f0(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(m=>n1(y[m],f[m]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const m=Ol(Ol({},this.getData(f)),y);this.map.set(f,m),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=cr(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class TE{constructor(t,r){this.core=t,this.logger=r,this.name=iE,this.version=sE,this.events=new jc,this.initialized=!1,this.storagePrefix=_i,this.ignoredPayloadTypes=[Bl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=mc(),a=await this.core.crypto.setSymKey(s),u=qr(X.FIVE_MINUTES),f={protocol:If},y={topic:a,expiry:u,relay:f,active:!1},m=P0({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:f}=Bh(s.uri);let y;if(this.pairings.keys.includes(a)&&(y=this.pairings.get(a),y.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const m=qr(X.FIVE_MINUTES),g={topic:a,relay:f,expiry:m,active:!1};return await this.pairings.set(a,g),this.core.expirer.set(a,m),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Fs.create,g),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f})),g},this.activate=async({topic:s})=>{this.isInitialized();const a=qr(X.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:y,reject:m}=fs();this.events.once(St("pairing_ping",u),({error:g})=>{g?m(g):y()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",kt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const f=Ui(a,u),y=await this.core.crypto.encode(s,f),m=Ms[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,y,m),f.id},this.sendResult=async(s,a,u)=>{const f=xa(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),g=Ms[m.request.method].res;await this.core.relayer.publish(a,y,g),await this.core.history.resolve(f)},this.sendError=async(s,a,u)=>{const f=qc(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),g=Ms[m.request.method]?Ms[m.request.method].res:Ms.unregistered_method.res;await this.core.relayer.publish(a,y,g),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,kt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>mi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(Fs.ping,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{vi(a)?this.events.emit(St("pairing_ping",u),{}):Lr(a)&&this.events.emit(St("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Fs.delete,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const y=kt("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,s,y),this.logger.error(y)}catch(y){await this.sendError(u,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(kt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!ar(s)){const{message:f}=B("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!S0(s.uri)){const{message:f}=B("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const u=Bh(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(u!=null&&u.symKey)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!ps(s,!1)){const{message:a}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(mi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=B("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=cr(r,this.name),this.pairings=new Ca(this.core,this.logger,this.name,this.storagePrefix)}get context(){return or(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Kt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{Lc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Zs(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Pr.expired,async t=>{const{topic:r}=Gl(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Fs.expire,{topic:r}))})}}class $E extends R_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Sr.EventEmitter,this.name=nE,this.version=aE,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:qr(X.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Kr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=Lr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Kr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Kr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Ui(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Kr.created,t=>{const r=Kr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.updated,t=>{const r=Kr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.deleted,t=>{const r=Kr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{X.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class NE extends D_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Sr.EventEmitter,this.name=oE,this.version=cE,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit(Pr.created,{target:u,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Pr.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return O0(t);if(typeof t=="number")return R0(t);const{message:r}=B("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Pr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;X.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Pr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Pr.created,t=>{const r=Pr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.expired,t=>{const r=Pr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.deleted,t=>{const r=Pr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class DE extends q_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=hc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||A0()||!Wl())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Oc;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(f),u=await this.fetchAttestation(s.attestationId,Oc)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(X.ONE_SECOND*2),f=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(hc))return u();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=hc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=u}),new Promise((u,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},X.toMiliseconds(X.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||ds;return uE.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${ds}`),a=ds),a},this.logger=cr(r,this.name),this.verifyUrl=ds,this.abortController=new AbortController,this.isDevEnv=C0()&&h1.IS_VITEST}get context(){return or(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),X.toMiliseconds(t))}}class qE extends L_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=hE,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:f,enableEncrypted:y=!1}=s,m=`${lE}/${this.projectId}/clients`;await u1(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:f,token:u,always_raw:y})})},this.logger=cr(r,this.context)}}var LE=Object.defineProperty,Rl=Object.getOwnPropertySymbols,jE=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,Al=(o,t,r)=>t in o?LE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Cl=(o,t)=>{for(var r in t||(t={}))jE.call(t,r)&&Al(o,r,t[r]);if(Rl)for(var r of Rl(t))zE.call(t,r)&&Al(o,r,t[r]);return o};class Uc extends O_{constructor(t){super(t),this.protocol=Ef,this.version=qb,this.name=Mc,this.events=new Sr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||xf,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||Lb.logger}));this.logger=cr(r,this.name),this.heartbeat=new vs.HeartBeat,this.crypto=new pE(this,this.logger,t==null?void 0:t.keychain),this.history=new $E(this,this.logger),this.expirer=new NE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Cw(Cl(Cl({},jb),t==null?void 0:t.storageOptions)),this.relayer=new OE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new TE(this,this.logger),this.verify=new DE(this.projectId||"",this.logger),this.echoClient=new qE(this.projectId||"",this.logger)}static async init(t){const r=new Uc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(Xb,s),r}get context(){return or(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const ME=Uc,Pf="wc",Sf=2,Of="client",Hc=`${Pf}@${Sf}:${Of}:`,fc={name:Of,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Tl="WALLETCONNECT_DEEPLINK_CHOICE",UE="proposal",Rf="Proposal expired",HE="session",fa=X.SEVEN_DAYS,kE="engine",Hs={wc_sessionPropose:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1104},res:{ttl:X.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1106},res:{ttl:X.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1112},res:{ttl:X.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1115}}},pc={min:X.FIVE_MINUTES,max:X.SEVEN_DAYS},si={idle:"IDLE",active:"ACTIVE"},KE="request",VE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var FE=Object.defineProperty,BE=Object.defineProperties,GE=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,WE=Object.prototype.hasOwnProperty,JE=Object.prototype.propertyIsEnumerable,Nl=(o,t,r)=>t in o?FE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,sr=(o,t)=>{for(var r in t||(t={}))WE.call(t,r)&&Nl(o,r,t[r]);if($l)for(var r of $l(t))JE.call(t,r)&&Nl(o,r,t[r]);return o},ks=(o,t)=>BE(o,GE(t));class QE extends z_{constructor(t){super(t),this.name=kE,this.events=new jc,this.initialized=!1,this.ignoredPayloadTypes=[Bl],this.requestQueue={state:si.idle,queue:[]},this.sessionRequestQueue={state:si.idle,queue:[]},this.requestQueueDelay=X.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Hs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=ks(sr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:y,relays:m}=s;let g=a,_,S=!1;if(g&&(S=this.client.core.pairing.pairings.get(g).active),!g||!S){const{topic:ae,uri:te}=await this.client.core.pairing.create();g=ae,_=te}const R=await this.client.core.crypto.generateKeyPair(),D=sr({requiredNamespaces:u,optionalNamespaces:f,relays:m??[{protocol:If}],proposer:{publicKey:R,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:C,resolve:Z,done:se}=fs(X.FIVE_MINUTES,Rf);if(this.events.once(St("session_connect"),async({error:ae,session:te})=>{if(ae)C(ae);else if(te){te.self.publicKey=R;const fe=ks(sr({},te),{requiredNamespaces:te.requiredNamespaces,optionalNamespaces:te.optionalNamespaces});await this.client.session.set(te.topic,fe),await this.setExpiry(te.topic,te.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:te.peer.metadata}),Z(fe)}}),!g){const{message:ae}=B("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(ae)}const ne=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:D}),ce=qr(X.FIVE_MINUTES);return await this.setProposal(ne,sr({id:ne,expiry:ce},D)),{uri:_,approval:se}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:f}=r,y=this.client.proposal.get(s);let{pairingTopic:m,proposer:g,requiredNamespaces:_,optionalNamespaces:S}=y;m=m||"",ya(_)||(_=$0(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),D=g.publicKey,C=await this.client.core.crypto.generateSharedKey(R,D);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:g.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const Z=sr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:_,optionalNamespaces:S,pairingTopic:m,controller:{publicKey:R,metadata:this.client.metadata},expiry:qr(fa)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(C),await this.sendRequest({topic:C,method:"wc_sessionSettle",params:Z,throwOnFailedPublish:!0});const se=ks(sr({},Z),{topic:C,pairingTopic:m,acknowledged:!1,self:Z.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:R});return await this.client.session.set(C,se),await this.setExpiry(C,qr(fa)),{topic:C,acknowledged:()=>new Promise(ne=>setTimeout(()=>ne(this.client.session.get(C)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:y,reject:m}=fs();return this.events.once(St("session_update",u),({error:g})=>{g?m(g):y()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:f,reject:y}=fs();return this.events.once(St("session_extend",a),({error:m})=>{m?y(m):f()}),await this.setExpiry(s,qr(fa)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:f}=r,y=ew(),{done:m,resolve:g,reject:_}=fs(f,"Request expired. Please try again.");return this.events.once(St("session_request",y),({error:S,result:R})=>{S?_(S):g(R)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:y,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(R=>_(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:y}),S()}),new Promise(async S=>{const R=await N0(this.client.core.storage,Tl);D0({id:y,topic:u,wcDeepLink:R}),S()}),m()]).then(S=>S[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;vi(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):Lr(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:f,reject:y}=fs();this.events.once(St("session_ping",a),({error:m})=>{m?y(m):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:kt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>q0(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,y;return((f=u.peerMetadata)==null?void 0:f.url)&&((y=u.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,kt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Tl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,kt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,kt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=si.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Hs.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f,verifyContext:y}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f,verifyContext:y}),s&&this.client.core.expirer.set(a,qr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:f,relayRpcId:y,clientRpcId:m,throwOnFailedPublish:g}=r,_=Ui(a,u,m);if(Wl()&&VE.includes(a)){const D=gs(JSON.stringify(_));this.client.core.verify.register({attestationId:D})}const S=await this.client.core.crypto.encode(s,_),R=Hs[a].req;return f&&(R.ttl=f),y&&(R.id=y),this.client.core.history.set(s,_),g?(R.internal=ks(sr({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,R)):this.client.core.relayer.publish(s,S,R).catch(D=>this.client.logger.error(D)),_.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:f}=r,y=xa(s,u),m=await this.client.core.crypto.encode(a,y),g=await this.client.core.history.get(a,s),_=Hs[g.request.method].res;f?(_.internal=ks(sr({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,m,_)):this.client.core.relayer.publish(a,m,_).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(y)},this.sendError=async(r,s,a)=>{const u=qc(r,a),f=await this.client.core.crypto.encode(s,u),y=await this.client.core.history.get(s,r),m=Hs[y.request.method].res;this.client.core.relayer.publish(s,f,m),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{mi(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{mi(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===si.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=si.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=si.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=B("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(sr({},s.params));const f=qr(X.FIVE_MINUTES),y=sr({id:u,pairingTopic:r,expiry:f},a);await this.setProposal(u,y);const m=gs(JSON.stringify(s)),g=await this.getVerifyContext(m,y.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:y,verifyContext:g})}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(vi(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const m=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const g=await this.client.core.crypto.generateSharedKey(y,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const _=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else Lr(s)&&(await this.client.proposal.delete(a,kt("USER_DISCONNECTED")),this.events.emit(St("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:y,expiry:m,namespaces:g,requiredNamespaces:_,optionalNamespaces:S,sessionProperties:R,pairingTopic:D}=s.params,C=sr({topic:r,relay:f,expiry:m,namespaces:g,acknowledged:!0,pairingTopic:D,requiredNamespaces:_,optionalNamespaces:S,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(St("session_connect"),{session:C}),this.cleanupDuplicatePairings(C)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;vi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(St("session_approve",a),{})):Lr(s)&&(await this.client.session.delete(r,kt("USER_DISCONNECTED")),this.events.emit(St("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const f=`${r}_session_update`,y=ca.get(f);if(y&&this.isRequestOutOfSync(y,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(sr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),ca.set(f,u)}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;vi(s)?this.events.emit(St("session_update",a),{}):Lr(s)&&this.events.emit(St("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,qr(fa)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;vi(s)?this.events.emit(St("session_extend",a),{}):Lr(s)&&this.events.emit(St("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{vi(s)?this.events.emit(St("session_ping",a),{}):Lr(s)&&this.events.emit(St("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Kt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(sr({topic:r},u));const f=gs(JSON.stringify(Ui("wc_sessionRequest",u,a))),y=this.client.session.get(r),m=await this.getVerifyContext(f,y.peer.metadata),g={id:a,topic:r,params:u,verifyContext:m};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;vi(s)?this.events.emit(St("session_request",a),{result:s.result}):Lr(s)&&this.events.emit(St("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const f=`${r}_session_event_${u.event.name}`,y=ca.get(f);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(sr({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),ca.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=si.idle,this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===si.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=si.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Ui("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:y}=r;if(wi(s)||await this.isValidPairingTopic(s),!L0(y)){const{message:m}=B("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(m)}!wi(a)&&ya(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!wi(u)&&ya(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),wi(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=j0(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!ar(r))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:f}=r;await this.isValidProposalId(s);const y=this.client.proposal.get(s),m=rc(a,"approve()");if(m)throw new Error(m.message);const g=Gh(y.requiredNamespaces,a,"approve()");if(g)throw new Error(g.message);if(!ps(u,!0)){const{message:_}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(_)}wi(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!ar(r)){const{message:u}=B("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!z0(a)){const{message:u}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!ar(r)){const{message:g}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:s,controller:a,namespaces:u,expiry:f}=r;if(!M0(s)){const{message:g}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const y=U0(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const m=rc(u,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(mi(f)){const{message:g}=B("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),f=rc(a,"update()");if(f)throw new Error(f.message);const y=Gh(u.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:s,request:a,chainId:u,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!Wh(y,u)){const{message:m}=B("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(m)}if(!H0(a)){const{message:m}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!k0(y,u,a.method)){const{message:m}=B("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(f&&!K0(f,pc)){const{message:m}=B("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${pc.min} and ${pc.max}`);throw new Error(m)}},this.isValidRespond=async r=>{var s;if(!ar(r)){const{message:f}=B("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(f)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(f){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),f}if(!V0(u)){const{message:f}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(f)}},this.isValidPing=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!ar(r)){const{message:y}=B("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!Wh(f,u)){const{message:y}=B("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(y)}if(!F0(a)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!B0(f,u,a.name)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||ds,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!ps(a,!1)){const{message:u}=B("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Kt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{Lc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Zs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Pr.expired,async t=>{const{topic:r,id:s}=Gl(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,B("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Fs.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!ps(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(mi(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=B("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!ps(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(mi(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=B("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(ps(t,!1)){const{message:r}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!G0(t)){const{message:r}=B("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(mi(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=B("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class YE extends Ca{constructor(t,r){super(t,r,UE,Hc),this.core=t,this.logger=r}}class ZE extends Ca{constructor(t,r){super(t,r,HE,Hc),this.core=t,this.logger=r}}class XE extends Ca{constructor(t,r){super(t,r,KE,Hc,s=>s.id),this.core=t,this.logger=r}}let eI=class Af extends j_{constructor(t){super(t),this.protocol=Pf,this.version=Sf,this.name=fc.name,this.events=new Sr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||fc.name,this.metadata=(t==null?void 0:t.metadata)||T0();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||fc.logger}));this.core=(t==null?void 0:t.core)||new ME(t),this.logger=cr(r,this.name),this.session=new ZE(this.core,this.logger),this.proposal=new YE(this.core,this.logger),this.pendingRequest=new XE(this.core,this.logger),this.engine=new QE(this)}static async init(t){const r=new Af(t);return await r.initialize(),r}get context(){return or(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class Ii extends Zl{constructor(t){super(t),this.events=new Sr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Ui(t.method,t.params||[],t.id||Dc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Lr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Zs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Dl="error",tI="wss://relay.walletconnect.com",rI="wc",iI="universal_provider",ql=`${rI}@2:${iI}:`,sI="https://rpc.walletconnect.com/v1/",ni={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",g=500,_="__lodash_placeholder__",S=1,R=2,D=4,C=1,Z=2,se=1,ne=2,ce=4,ae=8,te=16,fe=32,pe=64,Q=128,xe=256,Tt=512,yt=30,Yt="...",Vt=800,ur=16,M=1,U=2,Ge=3,qe=1/0,G=9007199254740991,K=17976931348623157e292,H=NaN,V=4294967295,Ot=V-1,rt=V>>>1,xi=[["ary",Q],["bind",se],["bindKey",ne],["curry",ae],["curryRight",te],["flip",Tt],["partial",fe],["partialRight",pe],["rearg",xe]],we="[object Arguments]",Or="[object Array]",$="[object AsyncFunction]",T="[object Boolean]",O="[object Date]",h="[object DOMException]",E="[object Error]",J="[object Function]",oe="[object GeneratorFunction]",ge="[object Map]",Pe="[object Number]",Oe="[object Null]",_e="[object Object]",vt="[object Promise]",lt="[object Proxy]",Ze="[object RegExp]",Ae="[object Set]",ke="[object String]",Ke="[object Symbol]",Xe="[object Undefined]",Ne="[object WeakMap]",Ve="[object WeakSet]",Se="[object ArrayBuffer]",Le="[object DataView]",it="[object Float32Array]",Te="[object Float64Array]",mt="[object Int8Array]",Rt="[object Int16Array]",Lt="[object Int32Array]",jt="[object Uint8Array]",$t="[object Uint8ClampedArray]",Ft="[object Uint16Array]",Zt="[object Uint32Array]",jr=/\b__p \+= '';/g,Bt=/\b(__p \+=) '' \+/g,Fr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ai=/&(?:amp|lt|gt|quot|#39);/g,Pi=/[&<>"']/g,st=RegExp(ai.source),We=RegExp(Pi.source),nt=/<%-([\s\S]+?)%>/g,at=/<%([\s\S]+?)%>/g,et=/<%=([\s\S]+?)%>/g,Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/,_t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,bt=RegExp(ot.source),ct=/^\s+/,ft=/\s/,ut=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,He=/\{\n\/\* \[wrapped with (.+)\] \*/,Et=/,? & /,It=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ta=/[()=,{}\[\]\/\s]/,$a=/\\(\\)?/g,Na=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,yr=/\w*$/,Da=/^[-+]0x[0-9a-f]+$/i,qa=/^0b[01]+$/i,La=/^\[object .+?Constructor\]$/,ja=/^0o[0-7]+$/i,za=/^(?:0|[1-9]\d*)$/,Br=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Vi=/($^)/,Ma=/['\n\r\u2028\u2029\\]/g,Fi="\\ud800-\\udfff",Ua="\\u0300-\\u036f",Ha="\\ufe20-\\ufe2f",Bi="\\u20d0-\\u20ff",rn=Ua+Ha+Bi,sn="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",ka="\\xac\\xb1\\xd7\\xf7",Ka="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Va="\\u2000-\\u206f",Fa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nn="A-Z\\xc0-\\xd6\\xd8-\\xde",an="\\ufe0e\\ufe0f",Si=ka+Ka+Va+Fa,ms="[']",Oi="["+Fi+"]",ws="["+Si+"]",Ri="["+rn+"]",on="\\d+",Ba="["+sn+"]",cn="["+Rr+"]",un="[^"+Fi+Si+on+sn+Rr+nn+"]",Gi="\\ud83c[\\udffb-\\udfff]",Ga="(?:"+Ri+"|"+Gi+")",hn="[^"+Fi+"]",Wi="(?:\\ud83c[\\udde6-\\uddff]){2}",oi="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="["+nn+"]",ln="\\u200d",fn="(?:"+cn+"|"+un+")",zr="(?:"+hr+"|"+un+")",pn="(?:"+ms+"(?:d|ll|m|re|s|t|ve))?",dn="(?:"+ms+"(?:D|LL|M|RE|S|T|VE))?",gn=Ga+"?",yn="["+an+"]?",Wa="(?:"+ln+"(?:"+[hn,Wi,oi].join("|")+")"+yn+gn+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",mn=yn+gn+Wa,Ji="(?:"+[Ba,Wi,oi].join("|")+")"+mn,Ja="(?:"+[hn+Ri+"?",Ri,Wi,oi,Oi].join("|")+")",_s=RegExp(ms,"g"),Qa=RegExp(Ri,"g"),Qi=RegExp(Gi+"(?="+Gi+")|"+Ja+mn,"g"),wn=RegExp([hr+"?"+cn+"+"+pn+"(?="+[ws,hr,"$"].join("|")+")",zr+"+"+dn+"(?="+[ws,hr+fn,"$"].join("|")+")",hr+"?"+fn+"+"+pn,hr+"+"+dn,vn,Gr,on,Ji].join("|"),"g"),_n=RegExp("["+ln+Fi+rn+an+"]"),Ai=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,bn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ya=-1,je={};je[it]=je[Te]=je[mt]=je[Rt]=je[Lt]=je[jt]=je[$t]=je[Ft]=je[Zt]=!0,je[we]=je[Or]=je[Se]=je[T]=je[Le]=je[O]=je[E]=je[J]=je[ge]=je[Pe]=je[_e]=je[Ze]=je[Ae]=je[ke]=je[Ne]=!1;var De={};De[we]=De[Or]=De[Se]=De[Le]=De[T]=De[O]=De[it]=De[Te]=De[mt]=De[Rt]=De[Lt]=De[ge]=De[Pe]=De[_e]=De[Ze]=De[Ae]=De[ke]=De[Ke]=De[jt]=De[$t]=De[Ft]=De[Zt]=!0,De[E]=De[J]=De[Ne]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},j={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},F={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ze=parseFloat,he=parseInt,Fe=typeof Ks=="object"&&Ks&&Ks.Object===Object&&Ks,xt=typeof self=="object"&&self&&self.Object===Object&&self,Ee=Fe||xt||Function("return this")(),Me=t&&!t.nodeType&&t,pt=Me&&!0&&o&&!o.nodeType&&o,Xt=pt&&pt.exports===Me,Pt=Xt&&Fe.process,Be=function(){try{var x=pt&&pt.require&&pt.require("util").types;return x||Pt&&Pt.binding&&Pt.binding("util")}catch{}}(),Gt=Be&&Be.isArrayBuffer,Ar=Be&&Be.isDate,vr=Be&&Be.isMap,Mr=Be&&Be.isRegExp,bs=Be&&Be.isSet,Ci=Be&&Be.isTypedArray;function Nt(x,N,A){switch(A.length){case 0:return x.call(N);case 1:return x.call(N,A[0]);case 2:return x.call(N,A[0],A[1]);case 3:return x.call(N,A[0],A[1],A[2])}return x.apply(N,A)}function $f(x,N,A,W){for(var ue=-1,Re=x==null?0:x.length;++ue<Re;){var At=x[ue];N(W,At,A(At),x)}return W}function mr(x,N){for(var A=-1,W=x==null?0:x.length;++A<W&&N(x[A],A,x)!==!1;);return x}function Nf(x,N){for(var A=x==null?0:x.length;A--&&N(x[A],A,x)!==!1;);return x}function Vc(x,N){for(var A=-1,W=x==null?0:x.length;++A<W;)if(!N(x[A],A,x))return!1;return!0}function ci(x,N){for(var A=-1,W=x==null?0:x.length,ue=0,Re=[];++A<W;){var At=x[A];N(At,A,x)&&(Re[ue++]=At)}return Re}function En(x,N){var A=x==null?0:x.length;return!!A&&Yi(x,N,0)>-1}function Za(x,N,A){for(var W=-1,ue=x==null?0:x.length;++W<ue;)if(A(N,x[W]))return!0;return!1}function Qe(x,N){for(var A=-1,W=x==null?0:x.length,ue=Array(W);++A<W;)ue[A]=N(x[A],A,x);return ue}function ui(x,N){for(var A=-1,W=N.length,ue=x.length;++A<W;)x[ue+A]=N[A];return x}function Xa(x,N,A,W){var ue=-1,Re=x==null?0:x.length;for(W&&Re&&(A=x[++ue]);++ue<Re;)A=N(A,x[ue],ue,x);return A}function Df(x,N,A,W){var ue=x==null?0:x.length;for(W&&ue&&(A=x[--ue]);ue--;)A=N(A,x[ue],ue,x);return A}function eo(x,N){for(var A=-1,W=x==null?0:x.length;++A<W;)if(N(x[A],A,x))return!0;return!1}var qf=to("length");function Lf(x){return x.split("")}function jf(x){return x.match(It)||[]}function Fc(x,N,A){var W;return A(x,function(ue,Re,At){if(N(ue,Re,At))return W=Re,!1}),W}function In(x,N,A,W){for(var ue=x.length,Re=A+(W?1:-1);W?Re--:++Re<ue;)if(N(x[Re],Re,x))return Re;return-1}function Yi(x,N,A){return N===N?Jf(x,N,A):In(x,Bc,A)}function zf(x,N,A,W){for(var ue=A-1,Re=x.length;++ue<Re;)if(W(x[ue],N))return ue;return-1}function Bc(x){return x!==x}function Gc(x,N){var A=x==null?0:x.length;return A?io(x,N)/A:H}function to(x){return function(N){return N==null?r:N[x]}}function ro(x){return function(N){return x==null?r:x[N]}}function Wc(x,N,A,W,ue){return ue(x,function(Re,At,Ue){A=W?(W=!1,Re):N(A,Re,At,Ue)}),A}function Mf(x,N){var A=x.length;for(x.sort(N);A--;)x[A]=x[A].value;return x}function io(x,N){for(var A,W=-1,ue=x.length;++W<ue;){var Re=N(x[W]);Re!==r&&(A=A===r?Re:A+Re)}return A}function so(x,N){for(var A=-1,W=Array(x);++A<x;)W[A]=N(A);return W}function Uf(x,N){return Qe(N,function(A){return[A,x[A]]})}function Jc(x){return x&&x.slice(0,Xc(x)+1).replace(ct,"")}function lr(x){return function(N){return x(N)}}function no(x,N){return Qe(N,function(A){return x[A]})}function Es(x,N){return x.has(N)}function Qc(x,N){for(var A=-1,W=x.length;++A<W&&Yi(N,x[A],0)>-1;);return A}function Yc(x,N){for(var A=x.length;A--&&Yi(N,x[A],0)>-1;);return A}function Hf(x,N){for(var A=x.length,W=0;A--;)x[A]===N&&++W;return W}var kf=ro(v),Kf=ro(I);function Vf(x){return"\\"+F[x]}function Ff(x,N){return x==null?r:x[N]}function Zi(x){return _n.test(x)}function Bf(x){return Ai.test(x)}function Gf(x){for(var N,A=[];!(N=x.next()).done;)A.push(N.value);return A}function ao(x){var N=-1,A=Array(x.size);return x.forEach(function(W,ue){A[++N]=[ue,W]}),A}function Zc(x,N){return function(A){return x(N(A))}}function hi(x,N){for(var A=-1,W=x.length,ue=0,Re=[];++A<W;){var At=x[A];(At===N||At===_)&&(x[A]=_,Re[ue++]=A)}return Re}function xn(x){var N=-1,A=Array(x.size);return x.forEach(function(W){A[++N]=W}),A}function Wf(x){var N=-1,A=Array(x.size);return x.forEach(function(W){A[++N]=[W,W]}),A}function Jf(x,N,A){for(var W=A-1,ue=x.length;++W<ue;)if(x[W]===N)return W;return-1}function Qf(x,N,A){for(var W=A+1;W--;)if(x[W]===N)return W;return W}function Xi(x){return Zi(x)?Zf(x):qf(x)}function Cr(x){return Zi(x)?Xf(x):Lf(x)}function Xc(x){for(var N=x.length;N--&&ft.test(x.charAt(N)););return N}var Yf=ro(j);function Zf(x){for(var N=Qi.lastIndex=0;Qi.test(x);)++N;return N}function Xf(x){return x.match(Qi)||[]}function ep(x){return x.match(wn)||[]}var tp=function x(N){N=N==null?Ee:es.defaults(Ee.Object(),N,es.pick(Ee,bn));var A=N.Array,W=N.Date,ue=N.Error,Re=N.Function,At=N.Math,Ue=N.Object,oo=N.RegExp,rp=N.String,wr=N.TypeError,Pn=A.prototype,ip=Re.prototype,ts=Ue.prototype,Sn=N["__core-js_shared__"],On=ip.toString,$e=ts.hasOwnProperty,sp=0,eu=function(){var e=/[^.]+$/.exec(Sn&&Sn.keys&&Sn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Rn=ts.toString,np=On.call(Ue),ap=Ee._,op=oo("^"+On.call($e).replace(ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),An=Xt?N.Buffer:r,li=N.Symbol,Cn=N.Uint8Array,tu=An?An.allocUnsafe:r,Tn=Zc(Ue.getPrototypeOf,Ue),ru=Ue.create,iu=ts.propertyIsEnumerable,$n=Pn.splice,su=li?li.isConcatSpreadable:r,Is=li?li.iterator:r,Ti=li?li.toStringTag:r,Nn=function(){try{var e=Li(Ue,"defineProperty");return e({},"",{}),e}catch{}}(),cp=N.clearTimeout!==Ee.clearTimeout&&N.clearTimeout,up=W&&W.now!==Ee.Date.now&&W.now,hp=N.setTimeout!==Ee.setTimeout&&N.setTimeout,Dn=At.ceil,qn=At.floor,co=Ue.getOwnPropertySymbols,lp=An?An.isBuffer:r,nu=N.isFinite,fp=Pn.join,pp=Zc(Ue.keys,Ue),Ct=At.max,Ut=At.min,dp=W.now,gp=N.parseInt,au=At.random,yp=Pn.reverse,uo=Li(N,"DataView"),xs=Li(N,"Map"),ho=Li(N,"Promise"),rs=Li(N,"Set"),Ps=Li(N,"WeakMap"),Ss=Li(Ue,"create"),Ln=Ps&&new Ps,is={},vp=ji(uo),mp=ji(xs),wp=ji(ho),_p=ji(rs),bp=ji(Ps),jn=li?li.prototype:r,Os=jn?jn.valueOf:r,ou=jn?jn.toString:r;function p(e){if(ht(e)&&!le(e)&&!(e instanceof be)){if(e instanceof _r)return e;if($e.call(e,"__wrapped__"))return ch(e)}return new _r(e)}var ss=function(){function e(){}return function(i){if(!tt(i))return{};if(ru)return ru(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function zn(){}function _r(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:nt,evaluate:at,interpolate:et,variable:"",imports:{_:p}},p.prototype=zn.prototype,p.prototype.constructor=p,_r.prototype=ss(zn.prototype),_r.prototype.constructor=_r;function be(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function Ep(){var e=new be(this.__wrapped__);return e.__actions__=er(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=er(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=er(this.__views__),e}function Ip(){if(this.__filtered__){var e=new be(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function xp(){var e=this.__wrapped__.value(),i=this.__dir__,n=le(e),c=i<0,l=n?e.length:0,d=Ld(0,l,this.__views__),w=d.start,b=d.end,P=b-w,q=c?b:w-1,L=this.__iteratees__,z=L.length,k=0,Y=Ut(P,this.__takeCount__);if(!n||!c&&l==P&&Y==P)return Tu(e,this.__actions__);var re=[];e:for(;P--&&k<Y;){q+=i;for(var ye=-1,ie=e[q];++ye<z;){var me=L[ye],Ie=me.iteratee,dr=me.type,Qt=Ie(ie);if(dr==U)ie=Qt;else if(!Qt){if(dr==M)continue e;break e}}re[k++]=ie}return re}be.prototype=ss(zn.prototype),be.prototype.constructor=be;function $i(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Pp(){this.__data__=Ss?Ss(null):{},this.size=0}function Sp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Op(e){var i=this.__data__;if(Ss){var n=i[e];return n===m?r:n}return $e.call(i,e)?i[e]:r}function Rp(e){var i=this.__data__;return Ss?i[e]!==r:$e.call(i,e)}function Ap(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ss&&i===r?m:i,this}$i.prototype.clear=Pp,$i.prototype.delete=Sp,$i.prototype.get=Op,$i.prototype.has=Rp,$i.prototype.set=Ap;function Wr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Cp(){this.__data__=[],this.size=0}function Tp(e){var i=this.__data__,n=Mn(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():$n.call(i,n,1),--this.size,!0}function $p(e){var i=this.__data__,n=Mn(i,e);return n<0?r:i[n][1]}function Np(e){return Mn(this.__data__,e)>-1}function Dp(e,i){var n=this.__data__,c=Mn(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}Wr.prototype.clear=Cp,Wr.prototype.delete=Tp,Wr.prototype.get=$p,Wr.prototype.has=Np,Wr.prototype.set=Dp;function Jr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function qp(){this.size=0,this.__data__={hash:new $i,map:new(xs||Wr),string:new $i}}function Lp(e){var i=Yn(this,e).delete(e);return this.size-=i?1:0,i}function jp(e){return Yn(this,e).get(e)}function zp(e){return Yn(this,e).has(e)}function Mp(e,i){var n=Yn(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}Jr.prototype.clear=qp,Jr.prototype.delete=Lp,Jr.prototype.get=jp,Jr.prototype.has=zp,Jr.prototype.set=Mp;function Ni(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new Jr;++i<n;)this.add(e[i])}function Up(e){return this.__data__.set(e,m),this}function Hp(e){return this.__data__.has(e)}Ni.prototype.add=Ni.prototype.push=Up,Ni.prototype.has=Hp;function Tr(e){var i=this.__data__=new Wr(e);this.size=i.size}function kp(){this.__data__=new Wr,this.size=0}function Kp(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function Vp(e){return this.__data__.get(e)}function Fp(e){return this.__data__.has(e)}function Bp(e,i){var n=this.__data__;if(n instanceof Wr){var c=n.__data__;if(!xs||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new Jr(c)}return n.set(e,i),this.size=n.size,this}Tr.prototype.clear=kp,Tr.prototype.delete=Kp,Tr.prototype.get=Vp,Tr.prototype.has=Fp,Tr.prototype.set=Bp;function cu(e,i){var n=le(e),c=!n&&zi(e),l=!n&&!c&&yi(e),d=!n&&!c&&!l&&cs(e),w=n||c||l||d,b=w?so(e.length,rp):[],P=b.length;for(var q in e)(i||$e.call(e,q))&&!(w&&(q=="length"||l&&(q=="offset"||q=="parent")||d&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||Xr(q,P)))&&b.push(q);return b}function uu(e){var i=e.length;return i?e[Eo(0,i-1)]:r}function Gp(e,i){return Zn(er(e),Di(i,0,e.length))}function Wp(e){return Zn(er(e))}function lo(e,i,n){(n!==r&&!$r(e[i],n)||n===r&&!(i in e))&&Qr(e,i,n)}function Rs(e,i,n){var c=e[i];(!($e.call(e,i)&&$r(c,n))||n===r&&!(i in e))&&Qr(e,i,n)}function Mn(e,i){for(var n=e.length;n--;)if($r(e[n][0],i))return n;return-1}function Jp(e,i,n,c){return fi(e,function(l,d,w){i(c,l,n(l),w)}),c}function hu(e,i){return e&&Hr(i,Dt(i),e)}function Qp(e,i){return e&&Hr(i,rr(i),e)}function Qr(e,i,n){i=="__proto__"&&Nn?Nn(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function fo(e,i){for(var n=-1,c=i.length,l=A(c),d=e==null;++n<c;)l[n]=d?r:Go(e,i[n]);return l}function Di(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function br(e,i,n,c,l,d){var w,b=i&S,P=i&R,q=i&D;if(n&&(w=l?n(e,c,l,d):n(e)),w!==r)return w;if(!tt(e))return e;var L=le(e);if(L){if(w=zd(e),!b)return er(e,w)}else{var z=Ht(e),k=z==J||z==oe;if(yi(e))return Du(e,b);if(z==_e||z==we||k&&!l){if(w=P||k?{}:Xu(e),!b)return P?Od(e,Qp(w,e)):Sd(e,hu(w,e))}else{if(!De[z])return l?e:{};w=Md(e,z,b)}}d||(d=new Tr);var Y=d.get(e);if(Y)return Y;d.set(e,w),Rh(e)?e.forEach(function(ie){w.add(br(ie,i,n,ie,e,d))}):Sh(e)&&e.forEach(function(ie,me){w.set(me,br(ie,i,n,me,e,d))});var re=q?P?No:$o:P?rr:Dt,ye=L?r:re(e);return mr(ye||e,function(ie,me){ye&&(me=ie,ie=e[me]),Rs(w,me,br(ie,i,n,me,e,d))}),w}function Yp(e){var i=Dt(e);return function(n){return lu(n,e,i)}}function lu(e,i,n){var c=n.length;if(e==null)return!c;for(e=Ue(e);c--;){var l=n[c],d=i[l],w=e[l];if(w===r&&!(l in e)||!d(w))return!1}return!0}function fu(e,i,n){if(typeof e!="function")throw new wr(f);return qs(function(){e.apply(r,n)},i)}function As(e,i,n,c){var l=-1,d=En,w=!0,b=e.length,P=[],q=i.length;if(!b)return P;n&&(i=Qe(i,lr(n))),c?(d=Za,w=!1):i.length>=a&&(d=Es,w=!1,i=new Ni(i));e:for(;++l<b;){var L=e[l],z=n==null?L:n(L);if(L=c||L!==0?L:0,w&&z===z){for(var k=q;k--;)if(i[k]===z)continue e;P.push(L)}else d(i,z,c)||P.push(L)}return P}var fi=Mu(Ur),pu=Mu(go,!0);function Zp(e,i){var n=!0;return fi(e,function(c,l,d){return n=!!i(c,l,d),n}),n}function Un(e,i,n){for(var c=-1,l=e.length;++c<l;){var d=e[c],w=i(d);if(w!=null&&(b===r?w===w&&!pr(w):n(w,b)))var b=w,P=d}return P}function Xp(e,i,n,c){var l=e.length;for(n=de(n),n<0&&(n=-n>l?0:l+n),c=c===r||c>l?l:de(c),c<0&&(c+=l),c=n>c?0:Ch(c);n<c;)e[n++]=i;return e}function du(e,i){var n=[];return fi(e,function(c,l,d){i(c,l,d)&&n.push(c)}),n}function zt(e,i,n,c,l){var d=-1,w=e.length;for(n||(n=Hd),l||(l=[]);++d<w;){var b=e[d];i>0&&n(b)?i>1?zt(b,i-1,n,c,l):ui(l,b):c||(l[l.length]=b)}return l}var po=Uu(),gu=Uu(!0);function Ur(e,i){return e&&po(e,i,Dt)}function go(e,i){return e&&gu(e,i,Dt)}function Hn(e,i){return ci(i,function(n){return ei(e[n])})}function qi(e,i){i=di(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[kr(i[n++])];return n&&n==c?e:r}function yu(e,i,n){var c=i(e);return le(e)?c:ui(c,n(e))}function Wt(e){return e==null?e===r?Xe:Oe:Ti&&Ti in Ue(e)?qd(e):Wd(e)}function yo(e,i){return e>i}function ed(e,i){return e!=null&&$e.call(e,i)}function td(e,i){return e!=null&&i in Ue(e)}function rd(e,i,n){return e>=Ut(i,n)&&e<Ct(i,n)}function vo(e,i,n){for(var c=n?Za:En,l=e[0].length,d=e.length,w=d,b=A(d),P=1/0,q=[];w--;){var L=e[w];w&&i&&(L=Qe(L,lr(i))),P=Ut(L.length,P),b[w]=!n&&(i||l>=120&&L.length>=120)?new Ni(w&&L):r}L=e[0];var z=-1,k=b[0];e:for(;++z<l&&q.length<P;){var Y=L[z],re=i?i(Y):Y;if(Y=n||Y!==0?Y:0,!(k?Es(k,re):c(q,re,n))){for(w=d;--w;){var ye=b[w];if(!(ye?Es(ye,re):c(e[w],re,n)))continue e}k&&k.push(re),q.push(Y)}}return q}function id(e,i,n,c){return Ur(e,function(l,d,w){i(c,n(l),d,w)}),c}function Cs(e,i,n){i=di(i,e),e=ih(e,i);var c=e==null?e:e[kr(Ir(i))];return c==null?r:Nt(c,e,n)}function vu(e){return ht(e)&&Wt(e)==we}function sd(e){return ht(e)&&Wt(e)==Se}function nd(e){return ht(e)&&Wt(e)==O}function Ts(e,i,n,c,l){return e===i?!0:e==null||i==null||!ht(e)&&!ht(i)?e!==e&&i!==i:ad(e,i,n,c,Ts,l)}function ad(e,i,n,c,l,d){var w=le(e),b=le(i),P=w?Or:Ht(e),q=b?Or:Ht(i);P=P==we?_e:P,q=q==we?_e:q;var L=P==_e,z=q==_e,k=P==q;if(k&&yi(e)){if(!yi(i))return!1;w=!0,L=!1}if(k&&!L)return d||(d=new Tr),w||cs(e)?Qu(e,i,n,c,l,d):Nd(e,i,P,n,c,l,d);if(!(n&C)){var Y=L&&$e.call(e,"__wrapped__"),re=z&&$e.call(i,"__wrapped__");if(Y||re){var ye=Y?e.value():e,ie=re?i.value():i;return d||(d=new Tr),l(ye,ie,n,c,d)}}return k?(d||(d=new Tr),Dd(e,i,n,c,l,d)):!1}function od(e){return ht(e)&&Ht(e)==ge}function mo(e,i,n,c){var l=n.length,d=l,w=!c;if(e==null)return!d;for(e=Ue(e);l--;){var b=n[l];if(w&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++l<d;){b=n[l];var P=b[0],q=e[P],L=b[1];if(w&&b[2]){if(q===r&&!(P in e))return!1}else{var z=new Tr;if(c)var k=c(q,L,P,e,i,z);if(!(k===r?Ts(L,q,C|Z,c,z):k))return!1}}return!0}function mu(e){if(!tt(e)||Kd(e))return!1;var i=ei(e)?op:La;return i.test(ji(e))}function cd(e){return ht(e)&&Wt(e)==Ze}function ud(e){return ht(e)&&Ht(e)==Ae}function hd(e){return ht(e)&&sa(e.length)&&!!je[Wt(e)]}function wu(e){return typeof e=="function"?e:e==null?ir:typeof e=="object"?le(e)?Eu(e[0],e[1]):bu(e):Hh(e)}function wo(e){if(!Ds(e))return pp(e);var i=[];for(var n in Ue(e))$e.call(e,n)&&n!="constructor"&&i.push(n);return i}function ld(e){if(!tt(e))return Gd(e);var i=Ds(e),n=[];for(var c in e)c=="constructor"&&(i||!$e.call(e,c))||n.push(c);return n}function _o(e,i){return e<i}function _u(e,i){var n=-1,c=tr(e)?A(e.length):[];return fi(e,function(l,d,w){c[++n]=i(l,d,w)}),c}function bu(e){var i=qo(e);return i.length==1&&i[0][2]?th(i[0][0],i[0][1]):function(n){return n===e||mo(n,e,i)}}function Eu(e,i){return jo(e)&&eh(i)?th(kr(e),i):function(n){var c=Go(n,e);return c===r&&c===i?Wo(n,e):Ts(i,c,C|Z)}}function kn(e,i,n,c,l){e!==i&&po(i,function(d,w){if(l||(l=new Tr),tt(d))fd(e,i,w,n,kn,c,l);else{var b=c?c(Mo(e,w),d,w+"",e,i,l):r;b===r&&(b=d),lo(e,w,b)}},rr)}function fd(e,i,n,c,l,d,w){var b=Mo(e,n),P=Mo(i,n),q=w.get(P);if(q){lo(e,n,q);return}var L=d?d(b,P,n+"",e,i,w):r,z=L===r;if(z){var k=le(P),Y=!k&&yi(P),re=!k&&!Y&&cs(P);L=P,k||Y||re?le(b)?L=b:dt(b)?L=er(b):Y?(z=!1,L=Du(P,!0)):re?(z=!1,L=qu(P,!0)):L=[]:Ls(P)||zi(P)?(L=b,zi(b)?L=Th(b):(!tt(b)||ei(b))&&(L=Xu(P))):z=!1}z&&(w.set(P,L),l(L,P,c,d,w),w.delete(P)),lo(e,n,L)}function Iu(e,i){var n=e.length;if(n)return i+=i<0?n:0,Xr(i,n)?e[i]:r}function xu(e,i,n){i.length?i=Qe(i,function(d){return le(d)?function(w){return qi(w,d.length===1?d[0]:d)}:d}):i=[ir];var c=-1;i=Qe(i,lr(ee()));var l=_u(e,function(d,w,b){var P=Qe(i,function(q){return q(d)});return{criteria:P,index:++c,value:d}});return Mf(l,function(d,w){return Pd(d,w,n)})}function pd(e,i){return Pu(e,i,function(n,c){return Wo(e,c)})}function Pu(e,i,n){for(var c=-1,l=i.length,d={};++c<l;){var w=i[c],b=qi(e,w);n(b,w)&&$s(d,di(w,e),b)}return d}function dd(e){return function(i){return qi(i,e)}}function bo(e,i,n,c){var l=c?zf:Yi,d=-1,w=i.length,b=e;for(e===i&&(i=er(i)),n&&(b=Qe(e,lr(n)));++d<w;)for(var P=0,q=i[d],L=n?n(q):q;(P=l(b,L,P,c))>-1;)b!==e&&$n.call(b,P,1),$n.call(e,P,1);return e}function Su(e,i){for(var n=e?i.length:0,c=n-1;n--;){var l=i[n];if(n==c||l!==d){var d=l;Xr(l)?$n.call(e,l,1):Po(e,l)}}return e}function Eo(e,i){return e+qn(au()*(i-e+1))}function gd(e,i,n,c){for(var l=-1,d=Ct(Dn((i-e)/(n||1)),0),w=A(d);d--;)w[c?d:++l]=e,e+=n;return w}function Io(e,i){var n="";if(!e||i<1||i>G)return n;do i%2&&(n+=e),i=qn(i/2),i&&(e+=e);while(i);return n}function ve(e,i){return Uo(rh(e,i,ir),e+"")}function yd(e){return uu(us(e))}function vd(e,i){var n=us(e);return Zn(n,Di(i,0,n.length))}function $s(e,i,n,c){if(!tt(e))return e;i=di(i,e);for(var l=-1,d=i.length,w=d-1,b=e;b!=null&&++l<d;){var P=kr(i[l]),q=n;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=w){var L=b[P];q=c?c(L,P,b):r,q===r&&(q=tt(L)?L:Xr(i[l+1])?[]:{})}Rs(b,P,q),b=b[P]}return e}var Ou=Ln?function(e,i){return Ln.set(e,i),e}:ir,md=Nn?function(e,i){return Nn(e,"toString",{configurable:!0,enumerable:!1,value:Qo(i),writable:!0})}:ir;function wd(e){return Zn(us(e))}function Er(e,i,n){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),n=n>l?l:n,n<0&&(n+=l),l=i>n?0:n-i>>>0,i>>>=0;for(var d=A(l);++c<l;)d[c]=e[c+i];return d}function _d(e,i){var n;return fi(e,function(c,l,d){return n=i(c,l,d),!n}),!!n}function Kn(e,i,n){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=rt){for(;c<l;){var d=c+l>>>1,w=e[d];w!==null&&!pr(w)&&(n?w<=i:w<i)?c=d+1:l=d}return l}return xo(e,i,ir,n)}function xo(e,i,n,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var w=i!==i,b=i===null,P=pr(i),q=i===r;l<d;){var L=qn((l+d)/2),z=n(e[L]),k=z!==r,Y=z===null,re=z===z,ye=pr(z);if(w)var ie=c||re;else q?ie=re&&(c||k):b?ie=re&&k&&(c||!Y):P?ie=re&&k&&!Y&&(c||!ye):Y||ye?ie=!1:ie=c?z<=i:z<i;ie?l=L+1:d=L}return Ut(d,Ot)}function Ru(e,i){for(var n=-1,c=e.length,l=0,d=[];++n<c;){var w=e[n],b=i?i(w):w;if(!n||!$r(b,P)){var P=b;d[l++]=w===0?0:w}}return d}function Au(e){return typeof e=="number"?e:pr(e)?H:+e}function fr(e){if(typeof e=="string")return e;if(le(e))return Qe(e,fr)+"";if(pr(e))return ou?ou.call(e):"";var i=e+"";return i=="0"&&1/e==-qe?"-0":i}function pi(e,i,n){var c=-1,l=En,d=e.length,w=!0,b=[],P=b;if(n)w=!1,l=Za;else if(d>=a){var q=i?null:Td(e);if(q)return xn(q);w=!1,l=Es,P=new Ni}else P=i?[]:b;e:for(;++c<d;){var L=e[c],z=i?i(L):L;if(L=n||L!==0?L:0,w&&z===z){for(var k=P.length;k--;)if(P[k]===z)continue e;i&&P.push(z),b.push(L)}else l(P,z,n)||(P!==b&&P.push(z),b.push(L))}return b}function Po(e,i){return i=di(i,e),e=ih(e,i),e==null||delete e[kr(Ir(i))]}function Cu(e,i,n,c){return $s(e,i,n(qi(e,i)),c)}function Vn(e,i,n,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return n?Er(e,c?0:d,c?d+1:l):Er(e,c?d+1:0,c?l:d)}function Tu(e,i){var n=e;return n instanceof be&&(n=n.value()),Xa(i,function(c,l){return l.func.apply(l.thisArg,ui([c],l.args))},n)}function So(e,i,n){var c=e.length;if(c<2)return c?pi(e[0]):[];for(var l=-1,d=A(c);++l<c;)for(var w=e[l],b=-1;++b<c;)b!=l&&(d[l]=As(d[l]||w,e[b],i,n));return pi(zt(d,1),i,n)}function $u(e,i,n){for(var c=-1,l=e.length,d=i.length,w={};++c<l;){var b=c<d?i[c]:r;n(w,e[c],b)}return w}function Oo(e){return dt(e)?e:[]}function Ro(e){return typeof e=="function"?e:ir}function di(e,i){return le(e)?e:jo(e,i)?[e]:oh(Ce(e))}var bd=ve;function gi(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:Er(e,i,n)}var Nu=cp||function(e){return Ee.clearTimeout(e)};function Du(e,i){if(i)return e.slice();var n=e.length,c=tu?tu(n):new e.constructor(n);return e.copy(c),c}function Ao(e){var i=new e.constructor(e.byteLength);return new Cn(i).set(new Cn(e)),i}function Ed(e,i){var n=i?Ao(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Id(e){var i=new e.constructor(e.source,yr.exec(e));return i.lastIndex=e.lastIndex,i}function xd(e){return Os?Ue(Os.call(e)):{}}function qu(e,i){var n=i?Ao(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Lu(e,i){if(e!==i){var n=e!==r,c=e===null,l=e===e,d=pr(e),w=i!==r,b=i===null,P=i===i,q=pr(i);if(!b&&!q&&!d&&e>i||d&&w&&P&&!b&&!q||c&&w&&P||!n&&P||!l)return 1;if(!c&&!d&&!q&&e<i||q&&n&&l&&!c&&!d||b&&n&&l||!w&&l||!P)return-1}return 0}function Pd(e,i,n){for(var c=-1,l=e.criteria,d=i.criteria,w=l.length,b=n.length;++c<w;){var P=Lu(l[c],d[c]);if(P){if(c>=b)return P;var q=n[c];return P*(q=="desc"?-1:1)}}return e.index-i.index}function ju(e,i,n,c){for(var l=-1,d=e.length,w=n.length,b=-1,P=i.length,q=Ct(d-w,0),L=A(P+q),z=!c;++b<P;)L[b]=i[b];for(;++l<w;)(z||l<d)&&(L[n[l]]=e[l]);for(;q--;)L[b++]=e[l++];return L}function zu(e,i,n,c){for(var l=-1,d=e.length,w=-1,b=n.length,P=-1,q=i.length,L=Ct(d-b,0),z=A(L+q),k=!c;++l<L;)z[l]=e[l];for(var Y=l;++P<q;)z[Y+P]=i[P];for(;++w<b;)(k||l<d)&&(z[Y+n[w]]=e[l++]);return z}function er(e,i){var n=-1,c=e.length;for(i||(i=A(c));++n<c;)i[n]=e[n];return i}function Hr(e,i,n,c){var l=!n;n||(n={});for(var d=-1,w=i.length;++d<w;){var b=i[d],P=c?c(n[b],e[b],b,n,e):r;P===r&&(P=e[b]),l?Qr(n,b,P):Rs(n,b,P)}return n}function Sd(e,i){return Hr(e,Lo(e),i)}function Od(e,i){return Hr(e,Yu(e),i)}function Fn(e,i){return function(n,c){var l=le(n)?$f:Jp,d=i?i():{};return l(n,e,ee(c,2),d)}}function ns(e){return ve(function(i,n){var c=-1,l=n.length,d=l>1?n[l-1]:r,w=l>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(l--,d):r,w&&Jt(n[0],n[1],w)&&(d=l<3?r:d,l=1),i=Ue(i);++c<l;){var b=n[c];b&&e(i,b,c,d)}return i})}function Mu(e,i){return function(n,c){if(n==null)return n;if(!tr(n))return e(n,c);for(var l=n.length,d=i?l:-1,w=Ue(n);(i?d--:++d<l)&&c(w[d],d,w)!==!1;);return n}}function Uu(e){return function(i,n,c){for(var l=-1,d=Ue(i),w=c(i),b=w.length;b--;){var P=w[e?b:++l];if(n(d[P],P,d)===!1)break}return i}}function Rd(e,i,n){var c=i&se,l=Ns(e);function d(){var w=this&&this!==Ee&&this instanceof d?l:e;return w.apply(c?n:this,arguments)}return d}function Hu(e){return function(i){i=Ce(i);var n=Zi(i)?Cr(i):r,c=n?n[0]:i.charAt(0),l=n?gi(n,1).join(""):i.slice(1);return c[e]()+l}}function as(e){return function(i){return Xa(Mh(zh(i).replace(_s,"")),e,"")}}function Ns(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=ss(e.prototype),c=e.apply(n,i);return tt(c)?c:n}}function Ad(e,i,n){var c=Ns(e);function l(){for(var d=arguments.length,w=A(d),b=d,P=os(l);b--;)w[b]=arguments[b];var q=d<3&&w[0]!==P&&w[d-1]!==P?[]:hi(w,P);if(d-=q.length,d<n)return Bu(e,i,Bn,l.placeholder,r,w,q,r,r,n-d);var L=this&&this!==Ee&&this instanceof l?c:e;return Nt(L,this,w)}return l}function ku(e){return function(i,n,c){var l=Ue(i);if(!tr(i)){var d=ee(n,3);i=Dt(i),n=function(b){return d(l[b],b,l)}}var w=e(i,n,c);return w>-1?l[d?i[w]:w]:r}}function Ku(e){return Zr(function(i){var n=i.length,c=n,l=_r.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new wr(f);if(l&&!w&&Qn(d)=="wrapper")var w=new _r([],!0)}for(c=w?c:n;++c<n;){d=i[c];var b=Qn(d),P=b=="wrapper"?Do(d):r;P&&zo(P[0])&&P[1]==(Q|ae|fe|xe)&&!P[4].length&&P[9]==1?w=w[Qn(P[0])].apply(w,P[3]):w=d.length==1&&zo(d)?w[b]():w.thru(d)}return function(){var q=arguments,L=q[0];if(w&&q.length==1&&le(L))return w.plant(L).value();for(var z=0,k=n?i[z].apply(this,q):L;++z<n;)k=i[z].call(this,k);return k}})}function Bn(e,i,n,c,l,d,w,b,P,q){var L=i&Q,z=i&se,k=i&ne,Y=i&(ae|te),re=i&Tt,ye=k?r:Ns(e);function ie(){for(var me=arguments.length,Ie=A(me),dr=me;dr--;)Ie[dr]=arguments[dr];if(Y)var Qt=os(ie),gr=Hf(Ie,Qt);if(c&&(Ie=ju(Ie,c,l,Y)),d&&(Ie=zu(Ie,d,w,Y)),me-=gr,Y&&me<q){var gt=hi(Ie,Qt);return Bu(e,i,Bn,ie.placeholder,n,Ie,gt,b,P,q-me)}var Nr=z?n:this,ri=k?Nr[e]:e;return me=Ie.length,b?Ie=Jd(Ie,b):re&&me>1&&Ie.reverse(),L&&P<me&&(Ie.length=P),this&&this!==Ee&&this instanceof ie&&(ri=ye||Ns(ri)),ri.apply(Nr,Ie)}return ie}function Vu(e,i){return function(n,c){return id(n,e,i(c),{})}}function Gn(e,i){return function(n,c){var l;if(n===r&&c===r)return i;if(n!==r&&(l=n),c!==r){if(l===r)return c;typeof n=="string"||typeof c=="string"?(n=fr(n),c=fr(c)):(n=Au(n),c=Au(c)),l=e(n,c)}return l}}function Co(e){return Zr(function(i){return i=Qe(i,lr(ee())),ve(function(n){var c=this;return e(i,function(l){return Nt(l,c,n)})})})}function Wn(e,i){i=i===r?" ":fr(i);var n=i.length;if(n<2)return n?Io(i,e):i;var c=Io(i,Dn(e/Xi(i)));return Zi(i)?gi(Cr(c),0,e).join(""):c.slice(0,e)}function Cd(e,i,n,c){var l=i&se,d=Ns(e);function w(){for(var b=-1,P=arguments.length,q=-1,L=c.length,z=A(L+P),k=this&&this!==Ee&&this instanceof w?d:e;++q<L;)z[q]=c[q];for(;P--;)z[q++]=arguments[++b];return Nt(k,l?n:this,z)}return w}function Fu(e){return function(i,n,c){return c&&typeof c!="number"&&Jt(i,n,c)&&(n=c=r),i=ti(i),n===r?(n=i,i=0):n=ti(n),c=c===r?i<n?1:-1:ti(c),gd(i,n,c,e)}}function Jn(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=xr(i),n=xr(n)),e(i,n)}}function Bu(e,i,n,c,l,d,w,b,P,q){var L=i&ae,z=L?w:r,k=L?r:w,Y=L?d:r,re=L?r:d;i|=L?fe:pe,i&=~(L?pe:fe),i&ce||(i&=~(se|ne));var ye=[e,i,l,Y,z,re,k,b,P,q],ie=n.apply(r,ye);return zo(e)&&sh(ie,ye),ie.placeholder=c,nh(ie,e,i)}function To(e){var i=At[e];return function(n,c){if(n=xr(n),c=c==null?0:Ut(de(c),292),c&&nu(n)){var l=(Ce(n)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(Ce(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(n)}}var Td=rs&&1/xn(new rs([,-0]))[1]==qe?function(e){return new rs(e)}:Xo;function Gu(e){return function(i){var n=Ht(i);return n==ge?ao(i):n==Ae?Wf(i):Uf(i,e(i))}}function Yr(e,i,n,c,l,d,w,b){var P=i&ne;if(!P&&typeof e!="function")throw new wr(f);var q=c?c.length:0;if(q||(i&=~(fe|pe),c=l=r),w=w===r?w:Ct(de(w),0),b=b===r?b:de(b),q-=l?l.length:0,i&pe){var L=c,z=l;c=l=r}var k=P?r:Do(e),Y=[e,i,n,c,l,L,z,d,w,b];if(k&&Bd(Y,k),e=Y[0],i=Y[1],n=Y[2],c=Y[3],l=Y[4],b=Y[9]=Y[9]===r?P?0:e.length:Ct(Y[9]-q,0),!b&&i&(ae|te)&&(i&=~(ae|te)),!i||i==se)var re=Rd(e,i,n);else i==ae||i==te?re=Ad(e,i,b):(i==fe||i==(se|fe))&&!l.length?re=Cd(e,i,n,c):re=Bn.apply(r,Y);var ye=k?Ou:sh;return nh(ye(re,Y),e,i)}function Wu(e,i,n,c){return e===r||$r(e,ts[n])&&!$e.call(c,n)?i:e}function Ju(e,i,n,c,l,d){return tt(e)&&tt(i)&&(d.set(i,e),kn(e,i,r,Ju,d),d.delete(i)),e}function $d(e){return Ls(e)?r:e}function Qu(e,i,n,c,l,d){var w=n&C,b=e.length,P=i.length;if(b!=P&&!(w&&P>b))return!1;var q=d.get(e),L=d.get(i);if(q&&L)return q==i&&L==e;var z=-1,k=!0,Y=n&Z?new Ni:r;for(d.set(e,i),d.set(i,e);++z<b;){var re=e[z],ye=i[z];if(c)var ie=w?c(ye,re,z,i,e,d):c(re,ye,z,e,i,d);if(ie!==r){if(ie)continue;k=!1;break}if(Y){if(!eo(i,function(me,Ie){if(!Es(Y,Ie)&&(re===me||l(re,me,n,c,d)))return Y.push(Ie)})){k=!1;break}}else if(!(re===ye||l(re,ye,n,c,d))){k=!1;break}}return d.delete(e),d.delete(i),k}function Nd(e,i,n,c,l,d,w){switch(n){case Le:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Se:return!(e.byteLength!=i.byteLength||!d(new Cn(e),new Cn(i)));case T:case O:case Pe:return $r(+e,+i);case E:return e.name==i.name&&e.message==i.message;case Ze:case ke:return e==i+"";case ge:var b=ao;case Ae:var P=c&C;if(b||(b=xn),e.size!=i.size&&!P)return!1;var q=w.get(e);if(q)return q==i;c|=Z,w.set(e,i);var L=Qu(b(e),b(i),c,l,d,w);return w.delete(e),L;case Ke:if(Os)return Os.call(e)==Os.call(i)}return!1}function Dd(e,i,n,c,l,d){var w=n&C,b=$o(e),P=b.length,q=$o(i),L=q.length;if(P!=L&&!w)return!1;for(var z=P;z--;){var k=b[z];if(!(w?k in i:$e.call(i,k)))return!1}var Y=d.get(e),re=d.get(i);if(Y&&re)return Y==i&&re==e;var ye=!0;d.set(e,i),d.set(i,e);for(var ie=w;++z<P;){k=b[z];var me=e[k],Ie=i[k];if(c)var dr=w?c(Ie,me,k,i,e,d):c(me,Ie,k,e,i,d);if(!(dr===r?me===Ie||l(me,Ie,n,c,d):dr)){ye=!1;break}ie||(ie=k=="constructor")}if(ye&&!ie){var Qt=e.constructor,gr=i.constructor;Qt!=gr&&"constructor"in e&&"constructor"in i&&!(typeof Qt=="function"&&Qt instanceof Qt&&typeof gr=="function"&&gr instanceof gr)&&(ye=!1)}return d.delete(e),d.delete(i),ye}function Zr(e){return Uo(rh(e,r,lh),e+"")}function $o(e){return yu(e,Dt,Lo)}function No(e){return yu(e,rr,Yu)}var Do=Ln?function(e){return Ln.get(e)}:Xo;function Qn(e){for(var i=e.name+"",n=is[i],c=$e.call(is,i)?n.length:0;c--;){var l=n[c],d=l.func;if(d==null||d==e)return l.name}return i}function os(e){var i=$e.call(p,"placeholder")?p:e;return i.placeholder}function ee(){var e=p.iteratee||Yo;return e=e===Yo?wu:e,arguments.length?e(arguments[0],arguments[1]):e}function Yn(e,i){var n=e.__data__;return kd(i)?n[typeof i=="string"?"string":"hash"]:n.map}function qo(e){for(var i=Dt(e),n=i.length;n--;){var c=i[n],l=e[c];i[n]=[c,l,eh(l)]}return i}function Li(e,i){var n=Ff(e,i);return mu(n)?n:r}function qd(e){var i=$e.call(e,Ti),n=e[Ti];try{e[Ti]=r;var c=!0}catch{}var l=Rn.call(e);return c&&(i?e[Ti]=n:delete e[Ti]),l}var Lo=co?function(e){return e==null?[]:(e=Ue(e),ci(co(e),function(i){return iu.call(e,i)}))}:ec,Yu=co?function(e){for(var i=[];e;)ui(i,Lo(e)),e=Tn(e);return i}:ec,Ht=Wt;(uo&&Ht(new uo(new ArrayBuffer(1)))!=Le||xs&&Ht(new xs)!=ge||ho&&Ht(ho.resolve())!=vt||rs&&Ht(new rs)!=Ae||Ps&&Ht(new Ps)!=Ne)&&(Ht=function(e){var i=Wt(e),n=i==_e?e.constructor:r,c=n?ji(n):"";if(c)switch(c){case vp:return Le;case mp:return ge;case wp:return vt;case _p:return Ae;case bp:return Ne}return i});function Ld(e,i,n){for(var c=-1,l=n.length;++c<l;){var d=n[c],w=d.size;switch(d.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Ut(i,e+w);break;case"takeRight":e=Ct(e,i-w);break}}return{start:e,end:i}}function jd(e){var i=e.match(He);return i?i[1].split(Et):[]}function Zu(e,i,n){i=di(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var w=kr(i[c]);if(!(d=e!=null&&n(e,w)))break;e=e[w]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&sa(l)&&Xr(w,l)&&(le(e)||zi(e)))}function zd(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&$e.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Xu(e){return typeof e.constructor=="function"&&!Ds(e)?ss(Tn(e)):{}}function Md(e,i,n){var c=e.constructor;switch(i){case Se:return Ao(e);case T:case O:return new c(+e);case Le:return Ed(e,n);case it:case Te:case mt:case Rt:case Lt:case jt:case $t:case Ft:case Zt:return qu(e,n);case ge:return new c;case Pe:case ke:return new c(e);case Ze:return Id(e);case Ae:return new c;case Ke:return xd(e)}}function Ud(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(ut,`{
/* [wrapped with `+i+`] */
`)}function Hd(e){return le(e)||zi(e)||!!(su&&e&&e[su])}function Xr(e,i){var n=typeof e;return i=i??G,!!i&&(n=="number"||n!="symbol"&&za.test(e))&&e>-1&&e%1==0&&e<i}function Jt(e,i,n){if(!tt(n))return!1;var c=typeof i;return(c=="number"?tr(n)&&Xr(i,n.length):c=="string"&&i in n)?$r(n[i],e):!1}function jo(e,i){if(le(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||pr(e)?!0:wt.test(e)||!Je.test(e)||i!=null&&e in Ue(i)}function kd(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function zo(e){var i=Qn(e),n=p[i];if(typeof n!="function"||!(i in be.prototype))return!1;if(e===n)return!0;var c=Do(n);return!!c&&e===c[0]}function Kd(e){return!!eu&&eu in e}var Vd=Sn?ei:tc;function Ds(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||ts;return e===n}function eh(e){return e===e&&!tt(e)}function th(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in Ue(n))}}function Fd(e){var i=ra(e,function(c){return n.size===g&&n.clear(),c}),n=i.cache;return i}function Bd(e,i){var n=e[1],c=i[1],l=n|c,d=l<(se|ne|Q),w=c==Q&&n==ae||c==Q&&n==xe&&e[7].length<=i[8]||c==(Q|xe)&&i[7].length<=i[8]&&n==ae;if(!(d||w))return e;c&se&&(e[2]=i[2],l|=n&se?0:ce);var b=i[3];if(b){var P=e[3];e[3]=P?ju(P,b,i[4]):b,e[4]=P?hi(e[3],_):i[4]}return b=i[5],b&&(P=e[5],e[5]=P?zu(P,b,i[6]):b,e[6]=P?hi(e[5],_):i[6]),b=i[7],b&&(e[7]=b),c&Q&&(e[8]=e[8]==null?i[8]:Ut(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function Gd(e){var i=[];if(e!=null)for(var n in Ue(e))i.push(n);return i}function Wd(e){return Rn.call(e)}function rh(e,i,n){return i=Ct(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=Ct(c.length-i,0),w=A(d);++l<d;)w[l]=c[i+l];l=-1;for(var b=A(i+1);++l<i;)b[l]=c[l];return b[i]=n(w),Nt(e,this,b)}}function ih(e,i){return i.length<2?e:qi(e,Er(i,0,-1))}function Jd(e,i){for(var n=e.length,c=Ut(i.length,n),l=er(e);c--;){var d=i[c];e[c]=Xr(d,n)?l[d]:r}return e}function Mo(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var sh=ah(Ou),qs=hp||function(e,i){return Ee.setTimeout(e,i)},Uo=ah(md);function nh(e,i,n){var c=i+"";return Uo(e,Ud(c,Qd(jd(c),n)))}function ah(e){var i=0,n=0;return function(){var c=dp(),l=ur-(c-n);if(n=c,l>0){if(++i>=Vt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function Zn(e,i){var n=-1,c=e.length,l=c-1;for(i=i===r?c:i;++n<i;){var d=Eo(n,l),w=e[d];e[d]=e[n],e[n]=w}return e.length=i,e}var oh=Fd(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(_t,function(n,c,l,d){i.push(l?d.replace($a,"$1"):c||n)}),i});function kr(e){if(typeof e=="string"||pr(e))return e;var i=e+"";return i=="0"&&1/e==-qe?"-0":i}function ji(e){if(e!=null){try{return On.call(e)}catch{}try{return e+""}catch{}}return""}function Qd(e,i){return mr(xi,function(n){var c="_."+n[0];i&n[1]&&!En(e,c)&&e.push(c)}),e.sort()}function ch(e){if(e instanceof be)return e.clone();var i=new _r(e.__wrapped__,e.__chain__);return i.__actions__=er(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Yd(e,i,n){(n?Jt(e,i,n):i===r)?i=1:i=Ct(de(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,w=A(Dn(c/i));l<c;)w[d++]=Er(e,l,l+=i);return w}function Zd(e){for(var i=-1,n=e==null?0:e.length,c=0,l=[];++i<n;){var d=e[i];d&&(l[c++]=d)}return l}function Xd(){var e=arguments.length;if(!e)return[];for(var i=A(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return ui(le(n)?er(n):[n],zt(i,1))}var eg=ve(function(e,i){return dt(e)?As(e,zt(i,1,dt,!0)):[]}),tg=ve(function(e,i){var n=Ir(i);return dt(n)&&(n=r),dt(e)?As(e,zt(i,1,dt,!0),ee(n,2)):[]}),rg=ve(function(e,i){var n=Ir(i);return dt(n)&&(n=r),dt(e)?As(e,zt(i,1,dt,!0),r,n):[]});function ig(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),Er(e,i<0?0:i,c)):[]}function sg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),i=c-i,Er(e,0,i<0?0:i)):[]}function ng(e,i){return e&&e.length?Vn(e,ee(i,3),!0,!0):[]}function ag(e,i){return e&&e.length?Vn(e,ee(i,3),!0):[]}function og(e,i,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Jt(e,i,n)&&(n=0,c=l),Xp(e,i,n,c)):[]}function uh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),In(e,ee(i,3),l)}function hh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==r&&(l=de(n),l=n<0?Ct(c+l,0):Ut(l,c-1)),In(e,ee(i,3),l,!0)}function lh(e){var i=e==null?0:e.length;return i?zt(e,1):[]}function cg(e){var i=e==null?0:e.length;return i?zt(e,qe):[]}function ug(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:de(i),zt(e,i)):[]}function hg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var l=e[i];c[l[0]]=l[1]}return c}function fh(e){return e&&e.length?e[0]:r}function lg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),Yi(e,i,l)}function fg(e){var i=e==null?0:e.length;return i?Er(e,0,-1):[]}var pg=ve(function(e){var i=Qe(e,Oo);return i.length&&i[0]===e[0]?vo(i):[]}),dg=ve(function(e){var i=Ir(e),n=Qe(e,Oo);return i===Ir(n)?i=r:n.pop(),n.length&&n[0]===e[0]?vo(n,ee(i,2)):[]}),gg=ve(function(e){var i=Ir(e),n=Qe(e,Oo);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?vo(n,r,i):[]});function yg(e,i){return e==null?"":fp.call(e,i)}function Ir(e){var i=e==null?0:e.length;return i?e[i-1]:r}function vg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==r&&(l=de(n),l=l<0?Ct(c+l,0):Ut(l,c-1)),i===i?Qf(e,i,l):In(e,Bc,l,!0)}function mg(e,i){return e&&e.length?Iu(e,de(i)):r}var wg=ve(ph);function ph(e,i){return e&&e.length&&i&&i.length?bo(e,i):e}function _g(e,i,n){return e&&e.length&&i&&i.length?bo(e,i,ee(n,2)):e}function bg(e,i,n){return e&&e.length&&i&&i.length?bo(e,i,r,n):e}var Eg=Zr(function(e,i){var n=e==null?0:e.length,c=fo(e,i);return Su(e,Qe(i,function(l){return Xr(l,n)?+l:l}).sort(Lu)),c});function Ig(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],d=e.length;for(i=ee(i,3);++c<d;){var w=e[c];i(w,c,e)&&(n.push(w),l.push(c))}return Su(e,l),n}function Ho(e){return e==null?e:yp.call(e)}function xg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Jt(e,i,n)?(i=0,n=c):(i=i==null?0:de(i),n=n===r?c:de(n)),Er(e,i,n)):[]}function Pg(e,i){return Kn(e,i)}function Sg(e,i,n){return xo(e,i,ee(n,2))}function Og(e,i){var n=e==null?0:e.length;if(n){var c=Kn(e,i);if(c<n&&$r(e[c],i))return c}return-1}function Rg(e,i){return Kn(e,i,!0)}function Ag(e,i,n){return xo(e,i,ee(n,2),!0)}function Cg(e,i){var n=e==null?0:e.length;if(n){var c=Kn(e,i,!0)-1;if($r(e[c],i))return c}return-1}function Tg(e){return e&&e.length?Ru(e):[]}function $g(e,i){return e&&e.length?Ru(e,ee(i,2)):[]}function Ng(e){var i=e==null?0:e.length;return i?Er(e,1,i):[]}function Dg(e,i,n){return e&&e.length?(i=n||i===r?1:de(i),Er(e,0,i<0?0:i)):[]}function qg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),i=c-i,Er(e,i<0?0:i,c)):[]}function Lg(e,i){return e&&e.length?Vn(e,ee(i,3),!1,!0):[]}function jg(e,i){return e&&e.length?Vn(e,ee(i,3)):[]}var zg=ve(function(e){return pi(zt(e,1,dt,!0))}),Mg=ve(function(e){var i=Ir(e);return dt(i)&&(i=r),pi(zt(e,1,dt,!0),ee(i,2))}),Ug=ve(function(e){var i=Ir(e);return i=typeof i=="function"?i:r,pi(zt(e,1,dt,!0),r,i)});function Hg(e){return e&&e.length?pi(e):[]}function kg(e,i){return e&&e.length?pi(e,ee(i,2)):[]}function Kg(e,i){return i=typeof i=="function"?i:r,e&&e.length?pi(e,r,i):[]}function ko(e){if(!(e&&e.length))return[];var i=0;return e=ci(e,function(n){if(dt(n))return i=Ct(n.length,i),!0}),so(i,function(n){return Qe(e,to(n))})}function dh(e,i){if(!(e&&e.length))return[];var n=ko(e);return i==null?n:Qe(n,function(c){return Nt(i,r,c)})}var Vg=ve(function(e,i){return dt(e)?As(e,i):[]}),Fg=ve(function(e){return So(ci(e,dt))}),Bg=ve(function(e){var i=Ir(e);return dt(i)&&(i=r),So(ci(e,dt),ee(i,2))}),Gg=ve(function(e){var i=Ir(e);return i=typeof i=="function"?i:r,So(ci(e,dt),r,i)}),Wg=ve(ko);function Jg(e,i){return $u(e||[],i||[],Rs)}function Qg(e,i){return $u(e||[],i||[],$s)}var Yg=ve(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,dh(e,n)});function gh(e){var i=p(e);return i.__chain__=!0,i}function Zg(e,i){return i(e),e}function Xn(e,i){return i(e)}var Xg=Zr(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,l=function(d){return fo(d,e)};return i>1||this.__actions__.length||!(c instanceof be)||!Xr(n)?this.thru(l):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:Xn,args:[l],thisArg:r}),new _r(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function ey(){return gh(this)}function ty(){return new _r(this.value(),this.__chain__)}function ry(){this.__values__===r&&(this.__values__=Ah(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function iy(){return this}function sy(e){for(var i,n=this;n instanceof zn;){var c=ch(n);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,i}function ny(){var e=this.__wrapped__;if(e instanceof be){var i=e;return this.__actions__.length&&(i=new be(this)),i=i.reverse(),i.__actions__.push({func:Xn,args:[Ho],thisArg:r}),new _r(i,this.__chain__)}return this.thru(Ho)}function ay(){return Tu(this.__wrapped__,this.__actions__)}var oy=Fn(function(e,i,n){$e.call(e,n)?++e[n]:Qr(e,n,1)});function cy(e,i,n){var c=le(e)?Vc:Zp;return n&&Jt(e,i,n)&&(i=r),c(e,ee(i,3))}function uy(e,i){var n=le(e)?ci:du;return n(e,ee(i,3))}var hy=ku(uh),ly=ku(hh);function fy(e,i){return zt(ea(e,i),1)}function py(e,i){return zt(ea(e,i),qe)}function dy(e,i,n){return n=n===r?1:de(n),zt(ea(e,i),n)}function yh(e,i){var n=le(e)?mr:fi;return n(e,ee(i,3))}function vh(e,i){var n=le(e)?Nf:pu;return n(e,ee(i,3))}var gy=Fn(function(e,i,n){$e.call(e,n)?e[n].push(i):Qr(e,n,[i])});function yy(e,i,n,c){e=tr(e)?e:us(e),n=n&&!c?de(n):0;var l=e.length;return n<0&&(n=Ct(l+n,0)),na(e)?n<=l&&e.indexOf(i,n)>-1:!!l&&Yi(e,i,n)>-1}var vy=ve(function(e,i,n){var c=-1,l=typeof i=="function",d=tr(e)?A(e.length):[];return fi(e,function(w){d[++c]=l?Nt(i,w,n):Cs(w,i,n)}),d}),my=Fn(function(e,i,n){Qr(e,n,i)});function ea(e,i){var n=le(e)?Qe:_u;return n(e,ee(i,3))}function wy(e,i,n,c){return e==null?[]:(le(i)||(i=i==null?[]:[i]),n=c?r:n,le(n)||(n=n==null?[]:[n]),xu(e,i,n))}var _y=Fn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function by(e,i,n){var c=le(e)?Xa:Wc,l=arguments.length<3;return c(e,ee(i,4),n,l,fi)}function Ey(e,i,n){var c=le(e)?Df:Wc,l=arguments.length<3;return c(e,ee(i,4),n,l,pu)}function Iy(e,i){var n=le(e)?ci:du;return n(e,ia(ee(i,3)))}function xy(e){var i=le(e)?uu:yd;return i(e)}function Py(e,i,n){(n?Jt(e,i,n):i===r)?i=1:i=de(i);var c=le(e)?Gp:vd;return c(e,i)}function Sy(e){var i=le(e)?Wp:wd;return i(e)}function Oy(e){if(e==null)return 0;if(tr(e))return na(e)?Xi(e):e.length;var i=Ht(e);return i==ge||i==Ae?e.size:wo(e).length}function Ry(e,i,n){var c=le(e)?eo:_d;return n&&Jt(e,i,n)&&(i=r),c(e,ee(i,3))}var Ay=ve(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Jt(e,i[0],i[1])?i=[]:n>2&&Jt(i[0],i[1],i[2])&&(i=[i[0]]),xu(e,zt(i,1),[])}),ta=up||function(){return Ee.Date.now()};function Cy(e,i){if(typeof i!="function")throw new wr(f);return e=de(e),function(){if(--e<1)return i.apply(this,arguments)}}function mh(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Yr(e,Q,r,r,r,r,i)}function wh(e,i){var n;if(typeof i!="function")throw new wr(f);return e=de(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Ko=ve(function(e,i,n){var c=se;if(n.length){var l=hi(n,os(Ko));c|=fe}return Yr(e,c,i,n,l)}),_h=ve(function(e,i,n){var c=se|ne;if(n.length){var l=hi(n,os(_h));c|=fe}return Yr(i,c,e,n,l)});function bh(e,i,n){i=n?r:i;var c=Yr(e,ae,r,r,r,r,r,i);return c.placeholder=bh.placeholder,c}function Eh(e,i,n){i=n?r:i;var c=Yr(e,te,r,r,r,r,r,i);return c.placeholder=Eh.placeholder,c}function Ih(e,i,n){var c,l,d,w,b,P,q=0,L=!1,z=!1,k=!0;if(typeof e!="function")throw new wr(f);i=xr(i)||0,tt(n)&&(L=!!n.leading,z="maxWait"in n,d=z?Ct(xr(n.maxWait)||0,i):d,k="trailing"in n?!!n.trailing:k);function Y(gt){var Nr=c,ri=l;return c=l=r,q=gt,w=e.apply(ri,Nr),w}function re(gt){return q=gt,b=qs(me,i),L?Y(gt):w}function ye(gt){var Nr=gt-P,ri=gt-q,kh=i-Nr;return z?Ut(kh,d-ri):kh}function ie(gt){var Nr=gt-P,ri=gt-q;return P===r||Nr>=i||Nr<0||z&&ri>=d}function me(){var gt=ta();if(ie(gt))return Ie(gt);b=qs(me,ye(gt))}function Ie(gt){return b=r,k&&c?Y(gt):(c=l=r,w)}function dr(){b!==r&&Nu(b),q=0,c=P=l=b=r}function Qt(){return b===r?w:Ie(ta())}function gr(){var gt=ta(),Nr=ie(gt);if(c=arguments,l=this,P=gt,Nr){if(b===r)return re(P);if(z)return Nu(b),b=qs(me,i),Y(P)}return b===r&&(b=qs(me,i)),w}return gr.cancel=dr,gr.flush=Qt,gr}var Ty=ve(function(e,i){return fu(e,1,i)}),$y=ve(function(e,i,n){return fu(e,xr(i)||0,n)});function Ny(e){return Yr(e,Tt)}function ra(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new wr(f);var n=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=n.cache;if(d.has(l))return d.get(l);var w=e.apply(this,c);return n.cache=d.set(l,w)||d,w};return n.cache=new(ra.Cache||Jr),n}ra.Cache=Jr;function ia(e){if(typeof e!="function")throw new wr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Dy(e){return wh(2,e)}var qy=bd(function(e,i){i=i.length==1&&le(i[0])?Qe(i[0],lr(ee())):Qe(zt(i,1),lr(ee()));var n=i.length;return ve(function(c){for(var l=-1,d=Ut(c.length,n);++l<d;)c[l]=i[l].call(this,c[l]);return Nt(e,this,c)})}),Vo=ve(function(e,i){var n=hi(i,os(Vo));return Yr(e,fe,r,i,n)}),xh=ve(function(e,i){var n=hi(i,os(xh));return Yr(e,pe,r,i,n)}),Ly=Zr(function(e,i){return Yr(e,xe,r,r,r,i)});function jy(e,i){if(typeof e!="function")throw new wr(f);return i=i===r?i:de(i),ve(e,i)}function zy(e,i){if(typeof e!="function")throw new wr(f);return i=i==null?0:Ct(de(i),0),ve(function(n){var c=n[i],l=gi(n,0,i);return c&&ui(l,c),Nt(e,this,l)})}function My(e,i,n){var c=!0,l=!0;if(typeof e!="function")throw new wr(f);return tt(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ih(e,i,{leading:c,maxWait:i,trailing:l})}function Uy(e){return mh(e,1)}function Hy(e,i){return Vo(Ro(i),e)}function ky(){if(!arguments.length)return[];var e=arguments[0];return le(e)?e:[e]}function Ky(e){return br(e,D)}function Vy(e,i){return i=typeof i=="function"?i:r,br(e,D,i)}function Fy(e){return br(e,S|D)}function By(e,i){return i=typeof i=="function"?i:r,br(e,S|D,i)}function Gy(e,i){return i==null||lu(e,i,Dt(i))}function $r(e,i){return e===i||e!==e&&i!==i}var Wy=Jn(yo),Jy=Jn(function(e,i){return e>=i}),zi=vu(function(){return arguments}())?vu:function(e){return ht(e)&&$e.call(e,"callee")&&!iu.call(e,"callee")},le=A.isArray,Qy=Gt?lr(Gt):sd;function tr(e){return e!=null&&sa(e.length)&&!ei(e)}function dt(e){return ht(e)&&tr(e)}function Yy(e){return e===!0||e===!1||ht(e)&&Wt(e)==T}var yi=lp||tc,Zy=Ar?lr(Ar):nd;function Xy(e){return ht(e)&&e.nodeType===1&&!Ls(e)}function ev(e){if(e==null)return!0;if(tr(e)&&(le(e)||typeof e=="string"||typeof e.splice=="function"||yi(e)||cs(e)||zi(e)))return!e.length;var i=Ht(e);if(i==ge||i==Ae)return!e.size;if(Ds(e))return!wo(e).length;for(var n in e)if($e.call(e,n))return!1;return!0}function tv(e,i){return Ts(e,i)}function rv(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?Ts(e,i,r,n):!!c}function Fo(e){if(!ht(e))return!1;var i=Wt(e);return i==E||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Ls(e)}function iv(e){return typeof e=="number"&&nu(e)}function ei(e){if(!tt(e))return!1;var i=Wt(e);return i==J||i==oe||i==$||i==lt}function Ph(e){return typeof e=="number"&&e==de(e)}function sa(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=G}function tt(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function ht(e){return e!=null&&typeof e=="object"}var Sh=vr?lr(vr):od;function sv(e,i){return e===i||mo(e,i,qo(i))}function nv(e,i,n){return n=typeof n=="function"?n:r,mo(e,i,qo(i),n)}function av(e){return Oh(e)&&e!=+e}function ov(e){if(Vd(e))throw new ue(u);return mu(e)}function cv(e){return e===null}function uv(e){return e==null}function Oh(e){return typeof e=="number"||ht(e)&&Wt(e)==Pe}function Ls(e){if(!ht(e)||Wt(e)!=_e)return!1;var i=Tn(e);if(i===null)return!0;var n=$e.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&On.call(n)==np}var Bo=Mr?lr(Mr):cd;function hv(e){return Ph(e)&&e>=-G&&e<=G}var Rh=bs?lr(bs):ud;function na(e){return typeof e=="string"||!le(e)&&ht(e)&&Wt(e)==ke}function pr(e){return typeof e=="symbol"||ht(e)&&Wt(e)==Ke}var cs=Ci?lr(Ci):hd;function lv(e){return e===r}function fv(e){return ht(e)&&Ht(e)==Ne}function pv(e){return ht(e)&&Wt(e)==Ve}var dv=Jn(_o),gv=Jn(function(e,i){return e<=i});function Ah(e){if(!e)return[];if(tr(e))return na(e)?Cr(e):er(e);if(Is&&e[Is])return Gf(e[Is]());var i=Ht(e),n=i==ge?ao:i==Ae?xn:us;return n(e)}function ti(e){if(!e)return e===0?e:0;if(e=xr(e),e===qe||e===-qe){var i=e<0?-1:1;return i*K}return e===e?e:0}function de(e){var i=ti(e),n=i%1;return i===i?n?i-n:i:0}function Ch(e){return e?Di(de(e),0,V):0}function xr(e){if(typeof e=="number")return e;if(pr(e))return H;if(tt(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=tt(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Jc(e);var n=qa.test(e);return n||ja.test(e)?he(e.slice(2),n?2:8):Da.test(e)?H:+e}function Th(e){return Hr(e,rr(e))}function yv(e){return e?Di(de(e),-G,G):e===0?e:0}function Ce(e){return e==null?"":fr(e)}var vv=ns(function(e,i){if(Ds(i)||tr(i)){Hr(i,Dt(i),e);return}for(var n in i)$e.call(i,n)&&Rs(e,n,i[n])}),$h=ns(function(e,i){Hr(i,rr(i),e)}),aa=ns(function(e,i,n,c){Hr(i,rr(i),e,c)}),mv=ns(function(e,i,n,c){Hr(i,Dt(i),e,c)}),wv=Zr(fo);function _v(e,i){var n=ss(e);return i==null?n:hu(n,i)}var bv=ve(function(e,i){e=Ue(e);var n=-1,c=i.length,l=c>2?i[2]:r;for(l&&Jt(i[0],i[1],l)&&(c=1);++n<c;)for(var d=i[n],w=rr(d),b=-1,P=w.length;++b<P;){var q=w[b],L=e[q];(L===r||$r(L,ts[q])&&!$e.call(e,q))&&(e[q]=d[q])}return e}),Ev=ve(function(e){return e.push(r,Ju),Nt(Nh,r,e)});function Iv(e,i){return Fc(e,ee(i,3),Ur)}function xv(e,i){return Fc(e,ee(i,3),go)}function Pv(e,i){return e==null?e:po(e,ee(i,3),rr)}function Sv(e,i){return e==null?e:gu(e,ee(i,3),rr)}function Ov(e,i){return e&&Ur(e,ee(i,3))}function Rv(e,i){return e&&go(e,ee(i,3))}function Av(e){return e==null?[]:Hn(e,Dt(e))}function Cv(e){return e==null?[]:Hn(e,rr(e))}function Go(e,i,n){var c=e==null?r:qi(e,i);return c===r?n:c}function Tv(e,i){return e!=null&&Zu(e,i,ed)}function Wo(e,i){return e!=null&&Zu(e,i,td)}var $v=Vu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Rn.call(i)),e[i]=n},Qo(ir)),Nv=Vu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Rn.call(i)),$e.call(e,i)?e[i].push(n):e[i]=[n]},ee),Dv=ve(Cs);function Dt(e){return tr(e)?cu(e):wo(e)}function rr(e){return tr(e)?cu(e,!0):ld(e)}function qv(e,i){var n={};return i=ee(i,3),Ur(e,function(c,l,d){Qr(n,i(c,l,d),c)}),n}function Lv(e,i){var n={};return i=ee(i,3),Ur(e,function(c,l,d){Qr(n,l,i(c,l,d))}),n}var jv=ns(function(e,i,n){kn(e,i,n)}),Nh=ns(function(e,i,n,c){kn(e,i,n,c)}),zv=Zr(function(e,i){var n={};if(e==null)return n;var c=!1;i=Qe(i,function(d){return d=di(d,e),c||(c=d.length>1),d}),Hr(e,No(e),n),c&&(n=br(n,S|R|D,$d));for(var l=i.length;l--;)Po(n,i[l]);return n});function Mv(e,i){return Dh(e,ia(ee(i)))}var Uv=Zr(function(e,i){return e==null?{}:pd(e,i)});function Dh(e,i){if(e==null)return{};var n=Qe(No(e),function(c){return[c]});return i=ee(i),Pu(e,n,function(c,l){return i(c,l[0])})}function Hv(e,i,n){i=di(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var d=e==null?r:e[kr(i[c])];d===r&&(c=l,d=n),e=ei(d)?d.call(e):d}return e}function kv(e,i,n){return e==null?e:$s(e,i,n)}function Kv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:$s(e,i,n,c)}var qh=Gu(Dt),Lh=Gu(rr);function Vv(e,i,n){var c=le(e),l=c||yi(e)||cs(e);if(i=ee(i,4),n==null){var d=e&&e.constructor;l?n=c?new d:[]:tt(e)?n=ei(d)?ss(Tn(e)):{}:n={}}return(l?mr:Ur)(e,function(w,b,P){return i(n,w,b,P)}),n}function Fv(e,i){return e==null?!0:Po(e,i)}function Bv(e,i,n){return e==null?e:Cu(e,i,Ro(n))}function Gv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Cu(e,i,Ro(n),c)}function us(e){return e==null?[]:no(e,Dt(e))}function Wv(e){return e==null?[]:no(e,rr(e))}function Jv(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=xr(n),n=n===n?n:0),i!==r&&(i=xr(i),i=i===i?i:0),Di(xr(e),i,n)}function Qv(e,i,n){return i=ti(i),n===r?(n=i,i=0):n=ti(n),e=xr(e),rd(e,i,n)}function Yv(e,i,n){if(n&&typeof n!="boolean"&&Jt(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ti(e),i===r?(i=e,e=0):i=ti(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var l=au();return Ut(e+l*(i-e+ze("1e-"+((l+"").length-1))),i)}return Eo(e,i)}var Zv=as(function(e,i,n){return i=i.toLowerCase(),e+(n?jh(i):i)});function jh(e){return Jo(Ce(e).toLowerCase())}function zh(e){return e=Ce(e),e&&e.replace(Br,kf).replace(Qa,"")}function Xv(e,i,n){e=Ce(e),i=fr(i);var c=e.length;n=n===r?c:Di(de(n),0,c);var l=n;return n-=i.length,n>=0&&e.slice(n,l)==i}function em(e){return e=Ce(e),e&&We.test(e)?e.replace(Pi,Kf):e}function tm(e){return e=Ce(e),e&&bt.test(e)?e.replace(ot,"\\$&"):e}var rm=as(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),im=as(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),sm=Hu("toLowerCase");function nm(e,i,n){e=Ce(e),i=de(i);var c=i?Xi(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return Wn(qn(l),n)+e+Wn(Dn(l),n)}function am(e,i,n){e=Ce(e),i=de(i);var c=i?Xi(e):0;return i&&c<i?e+Wn(i-c,n):e}function om(e,i,n){e=Ce(e),i=de(i);var c=i?Xi(e):0;return i&&c<i?Wn(i-c,n)+e:e}function cm(e,i,n){return n||i==null?i=0:i&&(i=+i),gp(Ce(e).replace(ct,""),i||0)}function um(e,i,n){return(n?Jt(e,i,n):i===r)?i=1:i=de(i),Io(Ce(e),i)}function hm(){var e=arguments,i=Ce(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var lm=as(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function fm(e,i,n){return n&&typeof n!="number"&&Jt(e,i,n)&&(i=n=r),n=n===r?V:n>>>0,n?(e=Ce(e),e&&(typeof i=="string"||i!=null&&!Bo(i))&&(i=fr(i),!i&&Zi(e))?gi(Cr(e),0,n):e.split(i,n)):[]}var pm=as(function(e,i,n){return e+(n?" ":"")+Jo(i)});function dm(e,i,n){return e=Ce(e),n=n==null?0:Di(de(n),0,e.length),i=fr(i),e.slice(n,n+i.length)==i}function gm(e,i,n){var c=p.templateSettings;n&&Jt(e,i,n)&&(i=r),e=Ce(e),i=aa({},i,c,Wu);var l=aa({},i.imports,c.imports,Wu),d=Dt(l),w=no(l,d),b,P,q=0,L=i.interpolate||Vi,z="__p += '",k=oo((i.escape||Vi).source+"|"+L.source+"|"+(L===et?Na:Vi).source+"|"+(i.evaluate||Vi).source+"|$","g"),Y="//# sourceURL="+($e.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ya+"]")+`
`;e.replace(k,function(ie,me,Ie,dr,Qt,gr){return Ie||(Ie=dr),z+=e.slice(q,gr).replace(Ma,Vf),me&&(b=!0,z+=`' +
__e(`+me+`) +
'`),Qt&&(P=!0,z+=`';
`+Qt+`;
__p += '`),Ie&&(z+=`' +
((__t = (`+Ie+`)) == null ? '' : __t) +
'`),q=gr+ie.length,ie}),z+=`';
`;var re=$e.call(i,"variable")&&i.variable;if(!re)z=`with (obj) {
`+z+`
}
`;else if(Ta.test(re))throw new ue(y);z=(P?z.replace(jr,""):z).replace(Bt,"$1").replace(Fr,"$1;"),z="function("+(re||"obj")+`) {
`+(re?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var ye=Uh(function(){return Re(d,Y+"return "+z).apply(r,w)});if(ye.source=z,Fo(ye))throw ye;return ye}function ym(e){return Ce(e).toLowerCase()}function vm(e){return Ce(e).toUpperCase()}function mm(e,i,n){if(e=Ce(e),e&&(n||i===r))return Jc(e);if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Cr(i),d=Qc(c,l),w=Yc(c,l)+1;return gi(c,d,w).join("")}function wm(e,i,n){if(e=Ce(e),e&&(n||i===r))return e.slice(0,Xc(e)+1);if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Yc(c,Cr(i))+1;return gi(c,0,l).join("")}function _m(e,i,n){if(e=Ce(e),e&&(n||i===r))return e.replace(ct,"");if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Qc(c,Cr(i));return gi(c,l).join("")}function bm(e,i){var n=yt,c=Yt;if(tt(i)){var l="separator"in i?i.separator:l;n="length"in i?de(i.length):n,c="omission"in i?fr(i.omission):c}e=Ce(e);var d=e.length;if(Zi(e)){var w=Cr(e);d=w.length}if(n>=d)return e;var b=n-Xi(c);if(b<1)return c;var P=w?gi(w,0,b).join(""):e.slice(0,b);if(l===r)return P+c;if(w&&(b+=P.length-b),Bo(l)){if(e.slice(b).search(l)){var q,L=P;for(l.global||(l=oo(l.source,Ce(yr.exec(l))+"g")),l.lastIndex=0;q=l.exec(L);)var z=q.index;P=P.slice(0,z===r?b:z)}}else if(e.indexOf(fr(l),b)!=b){var k=P.lastIndexOf(l);k>-1&&(P=P.slice(0,k))}return P+c}function Em(e){return e=Ce(e),e&&st.test(e)?e.replace(ai,Yf):e}var Im=as(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Jo=Hu("toUpperCase");function Mh(e,i,n){return e=Ce(e),i=n?r:i,i===r?Bf(e)?ep(e):jf(e):e.match(i)||[]}var Uh=ve(function(e,i){try{return Nt(e,r,i)}catch(n){return Fo(n)?n:new ue(n)}}),xm=Zr(function(e,i){return mr(i,function(n){n=kr(n),Qr(e,n,Ko(e[n],e))}),e});function Pm(e){var i=e==null?0:e.length,n=ee();return e=i?Qe(e,function(c){if(typeof c[1]!="function")throw new wr(f);return[n(c[0]),c[1]]}):[],ve(function(c){for(var l=-1;++l<i;){var d=e[l];if(Nt(d[0],this,c))return Nt(d[1],this,c)}})}function Sm(e){return Yp(br(e,S))}function Qo(e){return function(){return e}}function Om(e,i){return e==null||e!==e?i:e}var Rm=Ku(),Am=Ku(!0);function ir(e){return e}function Yo(e){return wu(typeof e=="function"?e:br(e,S))}function Cm(e){return bu(br(e,S))}function Tm(e,i){return Eu(e,br(i,S))}var $m=ve(function(e,i){return function(n){return Cs(n,e,i)}}),Nm=ve(function(e,i){return function(n){return Cs(e,n,i)}});function Zo(e,i,n){var c=Dt(i),l=Hn(i,c);n==null&&!(tt(i)&&(l.length||!c.length))&&(n=i,i=e,e=this,l=Hn(i,Dt(i)));var d=!(tt(n)&&"chain"in n)||!!n.chain,w=ei(e);return mr(l,function(b){var P=i[b];e[b]=P,w&&(e.prototype[b]=function(){var q=this.__chain__;if(d||q){var L=e(this.__wrapped__),z=L.__actions__=er(this.__actions__);return z.push({func:P,args:arguments,thisArg:e}),L.__chain__=q,L}return P.apply(e,ui([this.value()],arguments))})}),e}function Dm(){return Ee._===this&&(Ee._=ap),this}function Xo(){}function qm(e){return e=de(e),ve(function(i){return Iu(i,e)})}var Lm=Co(Qe),jm=Co(Vc),zm=Co(eo);function Hh(e){return jo(e)?to(kr(e)):dd(e)}function Mm(e){return function(i){return e==null?r:qi(e,i)}}var Um=Fu(),Hm=Fu(!0);function ec(){return[]}function tc(){return!1}function km(){return{}}function Km(){return""}function Vm(){return!0}function Fm(e,i){if(e=de(e),e<1||e>G)return[];var n=V,c=Ut(e,V);i=ee(i),e-=V;for(var l=so(c,i);++n<e;)i(n);return l}function Bm(e){return le(e)?Qe(e,kr):pr(e)?[e]:er(oh(Ce(e)))}function Gm(e){var i=++sp;return Ce(e)+i}var Wm=Gn(function(e,i){return e+i},0),Jm=To("ceil"),Qm=Gn(function(e,i){return e/i},1),Ym=To("floor");function Zm(e){return e&&e.length?Un(e,ir,yo):r}function Xm(e,i){return e&&e.length?Un(e,ee(i,2),yo):r}function e0(e){return Gc(e,ir)}function t0(e,i){return Gc(e,ee(i,2))}function r0(e){return e&&e.length?Un(e,ir,_o):r}function i0(e,i){return e&&e.length?Un(e,ee(i,2),_o):r}var s0=Gn(function(e,i){return e*i},1),n0=To("round"),a0=Gn(function(e,i){return e-i},0);function o0(e){return e&&e.length?io(e,ir):0}function c0(e,i){return e&&e.length?io(e,ee(i,2)):0}return p.after=Cy,p.ary=mh,p.assign=vv,p.assignIn=$h,p.assignInWith=aa,p.assignWith=mv,p.at=wv,p.before=wh,p.bind=Ko,p.bindAll=xm,p.bindKey=_h,p.castArray=ky,p.chain=gh,p.chunk=Yd,p.compact=Zd,p.concat=Xd,p.cond=Pm,p.conforms=Sm,p.constant=Qo,p.countBy=oy,p.create=_v,p.curry=bh,p.curryRight=Eh,p.debounce=Ih,p.defaults=bv,p.defaultsDeep=Ev,p.defer=Ty,p.delay=$y,p.difference=eg,p.differenceBy=tg,p.differenceWith=rg,p.drop=ig,p.dropRight=sg,p.dropRightWhile=ng,p.dropWhile=ag,p.fill=og,p.filter=uy,p.flatMap=fy,p.flatMapDeep=py,p.flatMapDepth=dy,p.flatten=lh,p.flattenDeep=cg,p.flattenDepth=ug,p.flip=Ny,p.flow=Rm,p.flowRight=Am,p.fromPairs=hg,p.functions=Av,p.functionsIn=Cv,p.groupBy=gy,p.initial=fg,p.intersection=pg,p.intersectionBy=dg,p.intersectionWith=gg,p.invert=$v,p.invertBy=Nv,p.invokeMap=vy,p.iteratee=Yo,p.keyBy=my,p.keys=Dt,p.keysIn=rr,p.map=ea,p.mapKeys=qv,p.mapValues=Lv,p.matches=Cm,p.matchesProperty=Tm,p.memoize=ra,p.merge=jv,p.mergeWith=Nh,p.method=$m,p.methodOf=Nm,p.mixin=Zo,p.negate=ia,p.nthArg=qm,p.omit=zv,p.omitBy=Mv,p.once=Dy,p.orderBy=wy,p.over=Lm,p.overArgs=qy,p.overEvery=jm,p.overSome=zm,p.partial=Vo,p.partialRight=xh,p.partition=_y,p.pick=Uv,p.pickBy=Dh,p.property=Hh,p.propertyOf=Mm,p.pull=wg,p.pullAll=ph,p.pullAllBy=_g,p.pullAllWith=bg,p.pullAt=Eg,p.range=Um,p.rangeRight=Hm,p.rearg=Ly,p.reject=Iy,p.remove=Ig,p.rest=jy,p.reverse=Ho,p.sampleSize=Py,p.set=kv,p.setWith=Kv,p.shuffle=Sy,p.slice=xg,p.sortBy=Ay,p.sortedUniq=Tg,p.sortedUniqBy=$g,p.split=fm,p.spread=zy,p.tail=Ng,p.take=Dg,p.takeRight=qg,p.takeRightWhile=Lg,p.takeWhile=jg,p.tap=Zg,p.throttle=My,p.thru=Xn,p.toArray=Ah,p.toPairs=qh,p.toPairsIn=Lh,p.toPath=Bm,p.toPlainObject=Th,p.transform=Vv,p.unary=Uy,p.union=zg,p.unionBy=Mg,p.unionWith=Ug,p.uniq=Hg,p.uniqBy=kg,p.uniqWith=Kg,p.unset=Fv,p.unzip=ko,p.unzipWith=dh,p.update=Bv,p.updateWith=Gv,p.values=us,p.valuesIn=Wv,p.without=Vg,p.words=Mh,p.wrap=Hy,p.xor=Fg,p.xorBy=Bg,p.xorWith=Gg,p.zip=Wg,p.zipObject=Jg,p.zipObjectDeep=Qg,p.zipWith=Yg,p.entries=qh,p.entriesIn=Lh,p.extend=$h,p.extendWith=aa,Zo(p,p),p.add=Wm,p.attempt=Uh,p.camelCase=Zv,p.capitalize=jh,p.ceil=Jm,p.clamp=Jv,p.clone=Ky,p.cloneDeep=Fy,p.cloneDeepWith=By,p.cloneWith=Vy,p.conformsTo=Gy,p.deburr=zh,p.defaultTo=Om,p.divide=Qm,p.endsWith=Xv,p.eq=$r,p.escape=em,p.escapeRegExp=tm,p.every=cy,p.find=hy,p.findIndex=uh,p.findKey=Iv,p.findLast=ly,p.findLastIndex=hh,p.findLastKey=xv,p.floor=Ym,p.forEach=yh,p.forEachRight=vh,p.forIn=Pv,p.forInRight=Sv,p.forOwn=Ov,p.forOwnRight=Rv,p.get=Go,p.gt=Wy,p.gte=Jy,p.has=Tv,p.hasIn=Wo,p.head=fh,p.identity=ir,p.includes=yy,p.indexOf=lg,p.inRange=Qv,p.invoke=Dv,p.isArguments=zi,p.isArray=le,p.isArrayBuffer=Qy,p.isArrayLike=tr,p.isArrayLikeObject=dt,p.isBoolean=Yy,p.isBuffer=yi,p.isDate=Zy,p.isElement=Xy,p.isEmpty=ev,p.isEqual=tv,p.isEqualWith=rv,p.isError=Fo,p.isFinite=iv,p.isFunction=ei,p.isInteger=Ph,p.isLength=sa,p.isMap=Sh,p.isMatch=sv,p.isMatchWith=nv,p.isNaN=av,p.isNative=ov,p.isNil=uv,p.isNull=cv,p.isNumber=Oh,p.isObject=tt,p.isObjectLike=ht,p.isPlainObject=Ls,p.isRegExp=Bo,p.isSafeInteger=hv,p.isSet=Rh,p.isString=na,p.isSymbol=pr,p.isTypedArray=cs,p.isUndefined=lv,p.isWeakMap=fv,p.isWeakSet=pv,p.join=yg,p.kebabCase=rm,p.last=Ir,p.lastIndexOf=vg,p.lowerCase=im,p.lowerFirst=sm,p.lt=dv,p.lte=gv,p.max=Zm,p.maxBy=Xm,p.mean=e0,p.meanBy=t0,p.min=r0,p.minBy=i0,p.stubArray=ec,p.stubFalse=tc,p.stubObject=km,p.stubString=Km,p.stubTrue=Vm,p.multiply=s0,p.nth=mg,p.noConflict=Dm,p.noop=Xo,p.now=ta,p.pad=nm,p.padEnd=am,p.padStart=om,p.parseInt=cm,p.random=Yv,p.reduce=by,p.reduceRight=Ey,p.repeat=um,p.replace=hm,p.result=Hv,p.round=n0,p.runInContext=x,p.sample=xy,p.size=Oy,p.snakeCase=lm,p.some=Ry,p.sortedIndex=Pg,p.sortedIndexBy=Sg,p.sortedIndexOf=Og,p.sortedLastIndex=Rg,p.sortedLastIndexBy=Ag,p.sortedLastIndexOf=Cg,p.startCase=pm,p.startsWith=dm,p.subtract=a0,p.sum=o0,p.sumBy=c0,p.template=gm,p.times=Fm,p.toFinite=ti,p.toInteger=de,p.toLength=Ch,p.toLower=ym,p.toNumber=xr,p.toSafeInteger=yv,p.toString=Ce,p.toUpper=vm,p.trim=mm,p.trimEnd=wm,p.trimStart=_m,p.truncate=bm,p.unescape=Em,p.uniqueId=Gm,p.upperCase=Im,p.upperFirst=Jo,p.each=yh,p.eachRight=vh,p.first=fh,Zo(p,function(){var e={};return Ur(p,function(i,n){$e.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,mr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),mr(["drop","take"],function(e,i){be.prototype[e]=function(n){n=n===r?1:Ct(de(n),0);var c=this.__filtered__&&!i?new be(this):this.clone();return c.__filtered__?c.__takeCount__=Ut(n,c.__takeCount__):c.__views__.push({size:Ut(n,V),type:e+(c.__dir__<0?"Right":"")}),c},be.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),mr(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==M||n==Ge;be.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ee(l,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),mr(["head","last"],function(e,i){var n="take"+(i?"Right":"");be.prototype[e]=function(){return this[n](1).value()[0]}}),mr(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");be.prototype[e]=function(){return this.__filtered__?new be(this):this[n](1)}}),be.prototype.compact=function(){return this.filter(ir)},be.prototype.find=function(e){return this.filter(e).head()},be.prototype.findLast=function(e){return this.reverse().find(e)},be.prototype.invokeMap=ve(function(e,i){return typeof e=="function"?new be(this):this.map(function(n){return Cs(n,e,i)})}),be.prototype.reject=function(e){return this.filter(ia(ee(e)))},be.prototype.slice=function(e,i){e=de(e);var n=this;return n.__filtered__&&(e>0||i<0)?new be(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=de(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},be.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},be.prototype.toArray=function(){return this.take(V)},Ur(be.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=p[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(p.prototype[i]=function(){var w=this.__wrapped__,b=c?[1]:arguments,P=w instanceof be,q=b[0],L=P||le(w),z=function(me){var Ie=l.apply(p,ui([me],b));return c&&k?Ie[0]:Ie};L&&n&&typeof q=="function"&&q.length!=1&&(P=L=!1);var k=this.__chain__,Y=!!this.__actions__.length,re=d&&!k,ye=P&&!Y;if(!d&&L){w=ye?w:new be(this);var ie=e.apply(w,b);return ie.__actions__.push({func:Xn,args:[z],thisArg:r}),new _r(ie,k)}return re&&ye?e.apply(this,b):(ie=this.thru(z),re?c?ie.value()[0]:ie.value():ie)})}),mr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Pn[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(le(d)?d:[],l)}return this[n](function(w){return i.apply(le(w)?w:[],l)})}}),Ur(be.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";$e.call(is,c)||(is[c]=[]),is[c].push({name:i,func:n})}}),is[Bn(r,ne).name]=[{name:"wrapper",func:r}],be.prototype.clone=Ep,be.prototype.reverse=Ip,be.prototype.value=xp,p.prototype.at=Xg,p.prototype.chain=ey,p.prototype.commit=ty,p.prototype.next=ry,p.prototype.plant=sy,p.prototype.reverse=ny,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=ay,p.prototype.first=p.prototype.head,Is&&(p.prototype[Is]=iy),p},es=tp();pt?((pt.exports=es)._=es,Me._=es):Ee._=es}).call(Ks)})(Rc,Rc.exports);var nI=Object.defineProperty,aI=Object.defineProperties,oI=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,cI=Object.prototype.hasOwnProperty,uI=Object.prototype.propertyIsEnumerable,jl=(o,t,r)=>t in o?nI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,pa=(o,t)=>{for(var r in t||(t={}))cI.call(t,r)&&jl(o,r,t[r]);if(Ll)for(var r of Ll(t))uI.call(t,r)&&jl(o,r,t[r]);return o},hI=(o,t)=>aI(o,oI(t));function bi(o,t,r){var s;const a=W0(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${sI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Ki(o){return o.includes(":")?o.split(":")[1]:o}function Cf(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function lI(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function fI(o={},t={}){const r=zl(o),s=zl(t);return Rc.exports.merge(r,s)}function zl(o){var t,r,s,a;const u={};if(!ya(o))return u;for(const[f,y]of Object.entries(o)){const m=Yl(f)?[f]:y.chains,g=y.methods||[],_=y.events||[],S=y.rpcMap||{},R=Vs(f);u[R]=hI(pa(pa({},u[R]),y),{chains:ic(m,(t=u[R])==null?void 0:t.chains),methods:ic(g,(r=u[R])==null?void 0:r.methods),events:ic(_,(s=u[R])==null?void 0:s.events),rpcMap:pa(pa({},S),(a=u[R])==null?void 0:a.rpcMap)})}return u}function pI(o){return o.includes(":")?o.split(":")[2]:o}function dI(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],f=s.accounts||[],y=Yl(r)?[r]:s.chains?s.chains:Cf(s.accounts);t[r]={chains:y,methods:a,events:u,accounts:f}}return t}function dc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const Tf={},Ye=o=>Tf[o],gc=(o,t)=>{Tf[o]=t};class gI{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class yI{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||bi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Ki(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class vI{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class mI{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class wI{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Ki(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class _I{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class bI{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class EI{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||bi(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace);return typeof s>"u"?void 0:new Ii(new Ei(s,Ye("disableProviderPing")))}}var II=Object.defineProperty,xI=Object.defineProperties,PI=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,SI=Object.prototype.hasOwnProperty,OI=Object.prototype.propertyIsEnumerable,Ul=(o,t,r)=>t in o?II(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,da=(o,t)=>{for(var r in t||(t={}))SI.call(t,r)&&Ul(o,r,t[r]);if(Ml)for(var r of Ml(t))OI.call(t,r)&&Ul(o,r,t[r]);return o},yc=(o,t)=>xI(o,PI(t));class kc{constructor(t){this.events=new jc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||Dl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new kc(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:da({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,xa(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:kt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=dI(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Rf)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ys(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await eI.init({logger:this.providerOpts.logger||Dl,relayUrl:this.providerOpts.relayUrl||tI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Vs(r)))];gc("client",this.client),gc("events",this.events),gc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=lI(r,this.session),a=Cf(s),u=fI(this.namespaces,this.optionalNamespaces),f=yc(da({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new yI({namespace:f});break;case"solana":this.rpcProviders[r]=new vI({namespace:f});break;case"cosmos":this.rpcProviders[r]=new mI({namespace:f});break;case"polkadot":this.rpcProviders[r]=new gI({namespace:f});break;case"cip34":this.rpcProviders[r]=new wI({namespace:f});break;case"elrond":this.rpcProviders[r]=new _I({namespace:f});break;case"multiversx":this.rpcProviders[r]=new bI({namespace:f});break;case"near":this.rpcProviders[r]=new EI({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&ys(a)&&this.events.emit("accountsChanged",a.map(pI))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,f=Vs(a),y=dc(a)!==dc(u)?`${f}:${dc(u)}`:a;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=yc(da({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",yc(da({},kt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(ni.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Vs(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Vs(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${ql}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${ql}/${t}`)}}const RI=kc,AI="wc",CI="ethereum_provider",TI=`${AI}@2:${CI}:`,$I="https://rpc.walletconnect.com/v1/",Ac=["eth_sendTransaction","personal_sign"],NI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Cc=["chainChanged","accountsChanged"],DI=["chainChanged","accountsChanged","message","disconnect","connect"];var qI=Object.defineProperty,LI=Object.defineProperties,jI=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,zI=Object.prototype.hasOwnProperty,MI=Object.prototype.propertyIsEnumerable,kl=(o,t,r)=>t in o?qI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Bs=(o,t)=>{for(var r in t||(t={}))zI.call(t,r)&&kl(o,r,t[r]);if(Hl)for(var r of Hl(t))MI.call(t,r)&&kl(o,r,t[r]);return o},Kl=(o,t)=>LI(o,jI(t));function ba(o){return Number(o[0].split(":")[1])}function vc(o){return`0x${o.toString(16)}`}function UI(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:f,rpcMap:y}=o;if(!ys(t))throw new Error("Invalid chains");const m={chains:t,methods:s||Ac,events:u||Cc,rpcMap:Bs({},t.length?{[ba(t)]:y[ba(t)]}:{})},g=u==null?void 0:u.filter(D=>!Cc.includes(D)),_=s==null?void 0:s.filter(D=>!Ac.includes(D));if(!r&&!f&&!a&&!(g!=null&&g.length)&&!(_!=null&&_.length))return{required:t.length?m:void 0};const S=(g==null?void 0:g.length)&&(_==null?void 0:_.length)||!r,R={chains:[...new Set(S?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:NI))],events:[...new Set(m.events.concat(f!=null&&f.length?f:DI))],rpcMap:y};return{required:t.length?m:void 0,optional:r.length?R:void 0}}class Kc{constructor(){this.events=new Sr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=TI,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Kc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=UI(this.rpc);try{const a=await new Promise(async(f,y)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Kl(Bs({namespaces:Bs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{f(g)}).catch(g=>{y(new Error(g.message))})});if(!a)return;const u=J0(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:vc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",vc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Kl(Bs({},kt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",vc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(t==null?void 0:t.methods)||Ac:[],m=a.length?(t==null?void 0:t.events)||Cc:[],g=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),R=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(D=>this.formatChainId(D)),optionalChains:u.map(D=>this.formatChainId(D)),methods:y,events:m,optionalMethods:g,optionalEvents:_,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:R,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?ba(this.rpc.chains):ba(this.rpc.optionalChains),this.signer=await RI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Q0(()=>import("./index-Btaf4GYW.js").then(a=>a.i),__vite__mapDeps([0,1,2]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Bs({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&ys(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&ys(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${$I}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const ix=Kc;export{ix as EthereumProvider,DI as OPTIONAL_EVENTS,NI as OPTIONAL_METHODS,Cc as REQUIRED_EVENTS,Ac as REQUIRED_METHODS,Kc as default};
